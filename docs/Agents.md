# Calcit ç¼–ç¨‹ Agent æŒ‡å—

æœ¬æ–‡æ¡£ä¸º AI Agent æä¾› Calcit é¡¹ç›®çš„æ“ä½œæŒ‡å—ã€‚

## âš ï¸ é‡è¦è­¦å‘Šï¼šç¦æ­¢ç›´æ¥ä¿®æ”¹çš„æ–‡ä»¶

ä»¥ä¸‹æ–‡ä»¶**ä¸¥æ ¼ç¦æ­¢ä½¿ç”¨æ–‡æœ¬æ›¿æ¢æˆ–ç›´æ¥ç¼–è¾‘**ï¼š

- **`calcit.cirru`** - è¿™æ˜¯ calcit-editor ç»“æ„åŒ–ç¼–è¾‘å™¨çš„ä¸“ç”¨æ ¼å¼ï¼ŒåŒ…å«å®Œæ•´çš„ç¼–è¾‘å™¨å…ƒæ•°æ®
- **`compact.cirru`** - è¿™æ˜¯ Calcit ç¨‹åºçš„ç´§å‡‘å¿«ç…§æ ¼å¼ï¼Œå¿…é¡»ä½¿ç”¨ `cr edit` ç›¸å…³å‘½ä»¤è¿›è¡Œä¿®æ”¹

è¿™ä¸¤ä¸ªæ–‡ä»¶çš„æ ¼å¼å¯¹ç©ºæ ¼å’Œç»“æ„æå…¶æ•æ„Ÿï¼Œç›´æ¥æ–‡æœ¬ä¿®æ”¹ä¼šç ´åæ–‡ä»¶ç»“æ„ã€‚è¯·ä½¿ç”¨ä¸‹é¢æ–‡æ¡£ä¸­çš„ CLI å‘½ä»¤è¿›è¡Œä»£ç æŸ¥è¯¢å’Œä¿®æ”¹ã€‚

## Calcit ä¸ Cirru çš„å…³ç³»

- **Calcit** æ˜¯ç¼–ç¨‹è¯­è¨€æœ¬èº«ï¼ˆä¸€é—¨ç±»ä¼¼ Clojure çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼‰
- **Cirru** æ˜¯è¯­æ³•æ ¼å¼ï¼ˆç¼©è¿›é£æ ¼çš„ S-expressionï¼Œç±»ä¼¼å»æ‰æ‹¬å·æ”¹ç”¨ç¼©è¿›çš„ Lispï¼‰
- **å…³ç³»**ï¼šCalcit ä»£ç ä½¿ç”¨ Cirru è¯­æ³•ä¹¦å†™å’Œå­˜å‚¨

**å…·ä½“ä½“ç°ï¼š**

- `compact.cirru` å’Œ `calcit.cirru` æ˜¯ç”¨ Cirru æ ¼å¼å­˜å‚¨çš„ Calcit ç¨‹åº
- `cr cirru` å·¥å…·ç”¨äº Cirru è¯­æ³•ä¸ JSON çš„è½¬æ¢ï¼ˆå¸®åŠ©ç†è§£å’Œç”Ÿæˆä»£ç ï¼‰
- Cirru è¯­æ³•ç‰¹ç‚¹ï¼š
  - ç”¨ç¼©è¿›ä»£æ›¿æ‹¬å·ï¼ˆç±»ä¼¼ Python/YAMLï¼‰
  - å­—ç¬¦ä¸²ç”¨å‰ç¼€ `|` æˆ– `"` æ ‡è®°ï¼ˆå¦‚ `|hello` è¡¨ç¤ºå­—ç¬¦ä¸² "hello"ï¼‰
  - å•è¡Œç”¨ç©ºæ ¼åˆ†éš”å…ƒç´ ï¼ˆå¦‚ `defn add (a b) (+ a b)`ï¼‰

**ç±»æ¯”ç†è§£ï¼š**

- Python è¯­è¨€ â† ä½¿ç”¨ â†’ Python è¯­æ³•
- Calcit è¯­è¨€ â† ä½¿ç”¨ â†’ Cirru è¯­æ³•

ç”Ÿæˆ Calcit ä»£ç å‰ï¼Œå»ºè®®å…ˆè¿è¡Œ `cr cirru show-guide` äº†è§£ Cirru è¯­æ³•è§„åˆ™ã€‚

---

## Calcit CLI å‘½ä»¤

Calcit ç¨‹åºä½¿ç”¨ `cr` å‘½ä»¤ï¼š

### ä¸»è¦è¿è¡Œå‘½ä»¤

- `cr` æˆ– `cr compact.cirru` - ä»£ç è§£é‡Šæ‰§è¡Œï¼Œé»˜è®¤è¯»å– config æ‰§è¡Œ init-fn å®šä¹‰çš„å…¥å£
- `cr compact.cirru js` - ç¼–è¯‘ç”Ÿæˆ JavaScript ä»£ç 
- `cr -1 <filepath>` - æ‰§è¡Œä¸€æ¬¡ç„¶åé€€å‡ºï¼ˆä¸è¿›å…¥ç›‘å¬æ¨¡å¼ï¼‰
- `cr --check-only` - ä»…æ£€æŸ¥ä»£ç æ­£ç¡®æ€§ï¼Œä¸æ‰§è¡Œç¨‹åº
  - å¯¹ init_fn å’Œ reload_fn è¿›è¡Œé¢„å¤„ç†éªŒè¯
  - è¾“å‡ºï¼šé¢„å¤„ç†è¿›åº¦ã€warningsã€æ£€æŸ¥è€—æ—¶
  - ç”¨äº CI/CD æˆ–å¿«é€ŸéªŒè¯ä»£ç ä¿®æ”¹
- `cr js -1` - æ£€æŸ¥ä»£ç æ­£ç¡®æ€§ï¼Œç”Ÿæˆ JavaScript(ä¸è¿›å…¥ç›‘å¬æ¨¡å¼)
- `cr js --check-only` - æ£€æŸ¥ä»£ç æ­£ç¡®æ€§ï¼Œä¸ç”Ÿæˆ JavaScript
- `cr eval '<code>'` - æ‰§è¡Œä¸€æ®µ Calcit ä»£ç ç‰‡æ®µï¼Œç”¨äºå¿«é€ŸéªŒè¯å†™æ³•

### æŸ¥è¯¢å­å‘½ä»¤ (`cr query`)

è¿™äº›å‘½ä»¤ç”¨äºæŸ¥è¯¢é¡¹ç›®ä¿¡æ¯ï¼š

**é¡¹ç›®å…¨å±€åˆ†æï¼š**

- `cr analyze call-graph` - åˆ†æä»å…¥å£ç‚¹å¼€å§‹çš„è°ƒç”¨å›¾ç»“æ„
- `cr analyze count-calls` - ç»Ÿè®¡æ¯ä¸ªå®šä¹‰çš„è°ƒç”¨æ¬¡æ•°

  _ä½¿ç”¨ç¤ºä¾‹ï¼š_

  ```bash
  # åˆ†ææ•´ä¸ªé¡¹ç›®çš„è°ƒç”¨å›¾
  cr analyze call-graph
  # ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°
  cr analyze count-calls
  ```

**åŸºç¡€æŸ¥è¯¢ï¼š**

- `cr query ns [--deps]` - åˆ—å‡ºé¡¹ç›®ä¸­æ‰€æœ‰å‘½åç©ºé—´ï¼ˆ--deps åŒ…å«ä¾èµ–ï¼‰
- `cr query ns <namespace>` - è¯»å–å‘½åç©ºé—´è¯¦æƒ…ï¼ˆimports, å®šä¹‰é¢„è§ˆï¼‰
- `cr query defs <namespace>` - åˆ—å‡ºå‘½åç©ºé—´ä¸­çš„å®šä¹‰
- `cr query pkg` - è·å–é¡¹ç›®åŒ…å
- `cr query config` - è¯»å–é¡¹ç›®é…ç½®ï¼ˆinit_fn, reload_fn, versionï¼‰
- `cr query error` - è¯»å– .calcit-error.cirru é”™è¯¯å †æ ˆæ–‡ä»¶
- `cr query modules` - åˆ—å‡ºé¡¹ç›®æ¨¡å—

**æ¸è¿›å¼ä»£ç æ¢ç´¢ï¼ˆProgressive Disclosureï¼‰ï¼š**

- `cr query peek <namespace/definition>` - æŸ¥çœ‹å®šä¹‰ç­¾åï¼ˆå‚æ•°ã€æ–‡æ¡£ã€è¡¨è¾¾å¼æ•°é‡ï¼‰ï¼Œä¸è¿”å›å®Œæ•´å®ç°ä½“
  - è¾“å‡ºï¼šDocã€Form ç±»å‹ã€å‚æ•°åˆ—è¡¨ã€Body è¡¨è¾¾å¼æ•°é‡ã€é¦–ä¸ªè¡¨è¾¾å¼é¢„è§ˆã€Examples æ•°é‡
  - ç”¨äºå¿«é€Ÿäº†è§£å‡½æ•°æ¥å£ï¼Œå‡å°‘ token æ¶ˆè€—
- `cr query def <namespace/definition>` - è¯»å–å®šä¹‰çš„å®Œæ•´è¯­æ³•æ ‘ï¼ˆJSON æ ¼å¼ï¼‰
  - åŒæ—¶æ˜¾ç¤º Doc å’Œ Examples çš„å®Œæ•´å†…å®¹
- `cr query examples <namespace/definition>` - è¯»å–å®šä¹‰çš„ç¤ºä¾‹ä»£ç 
  - è¾“å‡ºï¼šæ¯ä¸ª example çš„ Cirru æ ¼å¼å’Œ JSON æ ¼å¼

**ç¬¦å·æœç´¢ä¸å¼•ç”¨åˆ†æï¼š**

- `cr query find <symbol> [--deps] [-f] [-n <limit>]` - è·¨å‘½åç©ºé—´æœç´¢ç¬¦å·
  - é»˜è®¤ç²¾ç¡®åŒ¹é…ï¼šè¿”å›å®šä¹‰ä½ç½® + æ‰€æœ‰å¼•ç”¨ä½ç½®ï¼ˆå¸¦ä¸Šä¸‹æ–‡é¢„è§ˆï¼‰
  - `-f` / `--fuzzy`ï¼šæ¨¡ç³Šæœç´¢ï¼ŒåŒ¹é… "namespace/definition" æ ¼å¼çš„è·¯å¾„
  - `-n <limit>`ï¼šé™åˆ¶æ¨¡ç³Šæœç´¢ç»“æœæ•°é‡ï¼ˆé»˜è®¤ 20ï¼‰
  - `--deps`ï¼šåŒ…å«æ ¸å¿ƒå‘½åç©ºé—´ï¼ˆcalcit.\* å¼€å¤´ï¼‰
- `cr query usages <namespace/definition> [--deps]` - æŸ¥æ‰¾å®šä¹‰çš„æ‰€æœ‰ä½¿ç”¨ä½ç½®
  - è¿”å›ï¼šå¼•ç”¨è¯¥å®šä¹‰çš„æ‰€æœ‰ä½ç½®ï¼ˆå¸¦ä¸Šä¸‹æ–‡é¢„è§ˆï¼‰
  - ç”¨äºç†è§£ä»£ç å½±å“èŒƒå›´ï¼Œé‡æ„å‰çš„å½±å“åˆ†æ

**ä»£ç æ¨¡å¼æœç´¢ï¼š**

- `cr query search <pattern> [-f <namespace/definition>] [-l] [-d <depth>]` - æœç´¢å¶å­èŠ‚ç‚¹ï¼ˆå­—ç¬¦ä¸²ï¼‰

  - `<pattern>` - ä½ç½®å‚æ•°ï¼Œè¦æœç´¢çš„å­—ç¬¦ä¸²æ¨¡å¼
  - `-f` / `--filter` - è¿‡æ»¤åˆ°ç‰¹å®šå‘½åç©ºé—´æˆ–å®šä¹‰ï¼ˆå¯é€‰ï¼‰
  - `-l` / `--loose`ï¼šå®½æ¾åŒ¹é…ï¼ŒåŒ…å«æ¨¡å¼ï¼ˆåŒ¹é…æ‰€æœ‰åŒ…å«è¯¥æ¨¡å¼çš„å¶å­èŠ‚ç‚¹ï¼‰
  - `-d <depth>`ï¼šé™åˆ¶æœç´¢æ·±åº¦ï¼ˆ0 = æ— é™åˆ¶ï¼‰
  - è¿”å›ï¼šåŒ¹é…èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„ + çˆ¶çº§ä¸Šä¸‹æ–‡é¢„è§ˆ
  - ç¤ºä¾‹ï¼š
    - `cr query search "println" -f app.main/main -l` - åœ¨ main å‡½æ•°ä¸­æœç´¢åŒ…å« "println" çš„èŠ‚ç‚¹
    - `cr query search "div"` - å…¨å±€ç²¾ç¡®æœç´¢ "div"

- `cr query search-pattern <pattern> [-f <namespace/definition>] [-l] [-j] [-d <depth>]` - æœç´¢ç»“æ„æ¨¡å¼
  - `<pattern>` - ä½ç½®å‚æ•°ï¼ŒCirru one-liner æˆ– JSON æ•°ç»„æ¨¡å¼
  - `-f` / `--filter` - è¿‡æ»¤åˆ°ç‰¹å®šå‘½åç©ºé—´æˆ–å®šä¹‰ï¼ˆå¯é€‰ï¼‰
  - `-l` / `--loose`ï¼šå®½æ¾åŒ¹é…ï¼ŒæŸ¥æ‰¾åŒ…å«è¿ç»­å­åºåˆ—çš„ç»“æ„
  - `-j` / `--json`ï¼šå°†æ¨¡å¼è§£æä¸º JSON æ•°ç»„è€Œé Cirru
  - è¿”å›ï¼šåŒ¹é…èŠ‚ç‚¹çš„è·¯å¾„ + çˆ¶çº§ä¸Šä¸‹æ–‡
  - ç¤ºä¾‹ï¼š
    - `cr query search-pattern "(+ a b)" -f app.util/add` - æŸ¥æ‰¾ç²¾ç¡®è¡¨è¾¾å¼
    - `cr query search-pattern '["defn"]' -f app.main/main -j -l` - æŸ¥æ‰¾æ‰€æœ‰å‡½æ•°å®šä¹‰

**æœç´¢ç»“æœæ ¼å¼ï¼š**

- è¾“å‡ºæ ¼å¼ï¼š`[è·¯å¾„] in çˆ¶çº§ä¸Šä¸‹æ–‡`
- è·¯å¾„æ ¼å¼ï¼š`[ç´¢å¼•1,ç´¢å¼•2,...]` è¡¨ç¤ºä»æ ¹èŠ‚ç‚¹åˆ°åŒ¹é…èŠ‚ç‚¹çš„è·¯å¾„
- å¯é…åˆ `cr tree show <target> -p "<path>"` æŸ¥çœ‹å…·ä½“èŠ‚ç‚¹å†…å®¹

### æ–‡æ¡£å­å‘½ä»¤ (`cr docs`)

æŸ¥è¯¢ Calcit è¯­è¨€æ–‡æ¡£ï¼ˆguidebookï¼‰ï¼š

- `cr docs search <keyword> [-c <num>] [-f <filename>]` - æŒ‰å…³é”®è¯æœç´¢æ–‡æ¡£å†…å®¹

  - `-c <num>` - æ˜¾ç¤ºåŒ¹é…è¡Œçš„ä¸Šä¸‹æ–‡è¡Œæ•°ï¼ˆé»˜è®¤ 5ï¼‰
  - `-f <filename>` - æŒ‰æ–‡ä»¶åè¿‡æ»¤æœç´¢ç»“æœ
  - è¾“å‡ºï¼šåŒ¹é…è¡ŒåŠå…¶ä¸Šä¸‹æ–‡ï¼Œå¸¦è¡Œå·å’Œé«˜äº®
  - ç¤ºä¾‹ï¼š`cr docs search "macro" -c 10` æˆ– `cr docs search "defn" -f macros.md`

- `cr docs read <filename> [-s <start>] [-n <lines>]` - é˜…è¯»æŒ‡å®šæ–‡æ¡£

  - `-s <start>` - èµ·å§‹è¡Œå·ï¼ˆé»˜è®¤ 0ï¼‰
  - `-n <lines>` - è¯»å–è¡Œæ•°ï¼ˆé»˜è®¤ 80ï¼‰
  - è¾“å‡ºï¼šæ–‡æ¡£å†…å®¹ã€å½“å‰èŒƒå›´ã€æ˜¯å¦æœ‰æ›´å¤šå†…å®¹
  - ç¤ºä¾‹ï¼š`cr docs read macros.md` æˆ– `cr docs read intro.md -s 20 -n 30`

- `cr docs list` - åˆ—å‡ºæ‰€æœ‰å¯ç”¨æ–‡æ¡£

### Cirru è¯­æ³•å·¥å…· (`cr cirru`)

ç”¨äº Cirru è¯­æ³•å’Œ JSON ä¹‹é—´çš„è½¬æ¢ï¼š

- `cr cirru parse '<cirru_code>'` - è§£æ Cirru ä»£ç ä¸º JSON
- `cr cirru format '<json>'` - æ ¼å¼åŒ– JSON ä¸º Cirru ä»£ç 
- `cr cirru parse-edn '<edn>'` - è§£æ Cirru EDN ä¸º JSON
- `cr cirru show-guide` - æ˜¾ç¤º Cirru è¯­æ³•æŒ‡å—ï¼ˆå¸®åŠ© LLM ç”Ÿæˆæ­£ç¡®çš„ Cirru ä»£ç ï¼‰

**âš ï¸ é‡è¦ï¼šç”Ÿæˆ Cirru ä»£ç å‰è¯·å…ˆé˜…è¯»è¯­æ³•æŒ‡å—**

è¿è¡Œ `cr cirru show-guide` è·å–å®Œæ•´çš„ Cirru è¯­æ³•è¯´æ˜ï¼ŒåŒ…æ‹¬ï¼š

- `$` æ“ä½œç¬¦ï¼ˆå•èŠ‚ç‚¹å±•å¼€ï¼‰
- `|` å‰ç¼€ï¼ˆå­—ç¬¦ä¸²å­—é¢é‡ï¼‰, è¿™ä¸ªæ˜¯ Cirru ç‰¹æ®Šçš„åœ°æ–¹, è€Œä¸æ˜¯ç›´æ¥ç”¨å¼•å·åŒ…è£¹
- `,` æ“ä½œç¬¦ï¼ˆæ³¨é‡Šæ ‡è®°ï¼‰
- `~` å’Œ `~@`ï¼ˆå®å±•å¼€ï¼‰
- å¸¸è§é”™è¯¯å’Œé¿å…æ–¹æ³•

### åº“ç®¡ç† (`cr libs`)

æŸ¥è¯¢å’Œäº†è§£ Calcit å®˜æ–¹åº“ï¼š

- `cr libs` - åˆ—å‡ºæ‰€æœ‰å®˜æ–¹åº“
- `cr libs search <keyword>` - æŒ‰å…³é”®è¯æœç´¢åº“ï¼ˆæœç´¢åç§°ã€æè¿°ã€åˆ†ç±»ï¼‰
- `cr libs readme <package> [-f <file>]` - æŸ¥çœ‹åº“çš„æ–‡æ¡£
  - ä¼˜å…ˆä»æœ¬åœ° `~/.config/calcit/modules/<package>` è¯»å–
  - æœ¬åœ°ä¸å­˜åœ¨æ—¶ä» GitHub ä»“åº“è·å–
  - `-f` å‚æ•°å¯æŒ‡å®šå…¶ä»–æ–‡æ¡£æ–‡ä»¶ï¼ˆå¦‚ `-f Skills.md`ï¼‰
  - é»˜è®¤è¯»å– `README.md`
- `cr libs scan-md <module>` - æ‰«ææœ¬åœ°æ¨¡å—ç›®å½•ä¸‹çš„æ‰€æœ‰ `.md` æ–‡ä»¶
  - é€’å½’æ‰«æå­ç›®å½•
  - æ˜¾ç¤ºç›¸å¯¹è·¯å¾„åˆ—è¡¨
- `caps` - å®‰è£…/æ›´æ–°ä¾èµ–

### ç²¾ç»†ä»£ç æ ‘æ“ä½œ (`cr tree`)

âš ï¸ **å…³é”®è­¦å‘Šï¼šè·¯å¾„ç´¢å¼•åŠ¨æ€å˜åŒ–**

åˆ é™¤æˆ–æ’å…¥èŠ‚ç‚¹åï¼ŒåŒçº§åç»­èŠ‚ç‚¹çš„ç´¢å¼•ä¼šè‡ªåŠ¨æ”¹å˜ã€‚**å¿…é¡»ä»åå¾€å‰æ“ä½œ**æˆ–**æ¯æ¬¡ä¿®æ”¹åé‡æ–°æœç´¢è·¯å¾„**ã€‚è¯¦è§ [å¸¸è§é™·é˜± #1](#1-è·¯å¾„ç´¢å¼•åŠ¨æ€å˜åŒ–é—®é¢˜-)ã€‚

æä¾›å¯¹ AST èŠ‚ç‚¹çš„ä½çº§ç²¾ç¡®æ“ä½œï¼Œé€‚ç”¨äºéœ€è¦ç²¾ç»†æ§åˆ¶çš„åœºæ™¯ï¼š

**å¯ç”¨æ“ä½œï¼š**

- `cr tree show <namespace/definition> -p <path>` - æŸ¥çœ‹æŒ‡å®šè·¯å¾„çš„èŠ‚ç‚¹

  - `-p <path>` - èŠ‚ç‚¹è·¯å¾„ï¼Œç”¨é€—å·åˆ†éš”ç´¢å¼•ï¼ˆå¦‚ `"3,2,1"`ï¼‰ï¼Œç©ºå­—ç¬¦ä¸² `""` è¡¨ç¤ºæ ¹èŠ‚ç‚¹
  - `-d <depth>` - é™åˆ¶æ˜¾ç¤ºæ·±åº¦ï¼ˆ0=æ— é™ï¼Œé»˜è®¤ 2ï¼‰
  - **è¾“å‡ºæ ¼å¼**ï¼šCirru ç¼©è¿›æ ¼å¼çš„ä»£ç æ ‘ï¼Œ`[ç´¢å¼•]` æ ‡æ³¨æ¯ä¸ªå­èŠ‚ç‚¹ä½ç½®
  - **ä½¿ç”¨æŠ€å·§**ï¼š
    - å…ˆç”¨ `-d 1` æŸ¥çœ‹é¡¶å±‚ç»“æ„ï¼Œå†é€å±‚æ·±å…¥
    - è·¯å¾„ä¸­çš„ç´¢å¼•å¯¹åº”è¾“å‡ºä¸­çš„ `[0]`, `[1]`, `[2]` ç­‰æ ‡è®°
    - é…åˆ `cr query search` å¿«é€Ÿå®šä½ç›®æ ‡èŠ‚ç‚¹

- `cr tree replace <namespace/definition> -p <path>` - æ›¿æ¢æŒ‡å®šè·¯å¾„çš„èŠ‚ç‚¹

  - **è¾“å…¥æ–¹å¼**ï¼ˆæŒ‰æ¨èä¼˜å…ˆçº§ï¼‰ï¼š

  1.  `-e '<expr>'` - **æœ€æ¨è**ã€‚æ”¯æŒ Cirru one-linerï¼Œä¹Ÿæ”¯æŒè‡ªåŠ¨è¯†åˆ« JSON (å¦‚ `-e '["a"]'`)ã€‚
  2.  `-j '<json>'` - æ˜¾å¼ä¼ å…¥å†…è” JSON å­—ç¬¦ä¸²ã€‚
  3.  `-f <file>` - ä»æ–‡ä»¶è¯»å–ï¼ˆé»˜è®¤ Cirruï¼ŒåŠ  `-J` è¯» JSONï¼‰ã€‚
  4.  `-s` - ä» stdin è¯»å–ï¼ˆé»˜è®¤ Cirruï¼ŒåŠ  `-J` è¯» JSONï¼‰ã€‚

  - **ç‰¹æ®Šå‚æ•°**ï¼š

    - `--leaf` - é…åˆ `-e`/`-f`/`-s` å°†è¾“å…¥è§†ä¸º leaf èŠ‚ç‚¹
      - ç¬¦å·ï¼š`--leaf -e 'my-var'`
      - å­—ç¬¦ä¸²ï¼š`--leaf -e '|text'`ï¼ˆå®æµ‹æœ€å¿«æ·ï¼Œç¤ºä¾‹ï¼š`cr tree replace respo.app.core/new-fn -p "3,1" --leaf -e '|hello'`ï¼‰
    - `--refer-original <name>` - åœ¨æ–°ä»£ç ä¸­å¼•ç”¨åŸèŠ‚ç‚¹ï¼ˆé«˜çº§ç”¨æ³•ï¼‰
    - `--refer-inner-branch <path>` - å¼•ç”¨åŸèŠ‚ç‚¹çš„å†…éƒ¨åˆ†æ”¯
    - `--refer-inner-placeholder <name>` - å†…éƒ¨åˆ†æ”¯çš„å ä½ç¬¦å

  - **å¿«é€Ÿå†³ç­–**ï¼š
    - æ›¿æ¢è¡¨è¾¾å¼ â†’ ç”¨ `-e 'cirru one-liner'`
    - æ›¿æ¢å•ä¸ªå€¼ â†’ ç”¨ `--leaf -e '<symbol æˆ– |string>'`ï¼ˆé¿å…è¢«åŒ…è£…æˆ listï¼‰

- `cr tree delete <namespace/definition> -p <path>` - åˆ é™¤æŒ‡å®šè·¯å¾„çš„èŠ‚ç‚¹

  - `-p <path>` - è¦åˆ é™¤çš„èŠ‚ç‚¹è·¯å¾„ï¼ˆå®Œæ•´è·¯å¾„ï¼Œå«æœ€åç´¢å¼•ï¼‰
  - âš ï¸ **å‰¯ä½œç”¨**ï¼šåˆ é™¤åï¼ŒåŒçº§åç»­èŠ‚ç‚¹çš„ç´¢å¼•ä¼šå‰ç§»
  - **ç¤ºä¾‹**ï¼šåˆ é™¤ `[3,2,1]` åï¼ŒåŸ `[3,2,2]` å˜æˆ `[3,2,1]`

- `cr tree insert-before <namespace/definition> -p <path>` - åœ¨æŒ‡å®šä½ç½®å‰æ’å…¥èŠ‚ç‚¹

  - `-p <path>` - å‚è€ƒèŠ‚ç‚¹çš„è·¯å¾„ï¼ˆåœ¨æ­¤èŠ‚ç‚¹ä¹‹å‰æ’å…¥ï¼‰
  - è¾“å…¥æ–¹å¼åŒ `replace`ï¼ˆ`-e`, `-j`, `-f`, `-s`ï¼‰
  - **ç»“æœ**ï¼šæ–°èŠ‚ç‚¹å æ®å½“å‰ç´¢å¼•ï¼ŒåŸèŠ‚ç‚¹åŠåç»­èŠ‚ç‚¹ç´¢å¼• +1

- `cr tree insert-after <namespace/definition> -p <path>` - åœ¨æŒ‡å®šä½ç½®åæ’å…¥èŠ‚ç‚¹

  - `-p <path>` - å‚è€ƒèŠ‚ç‚¹çš„è·¯å¾„ï¼ˆåœ¨æ­¤èŠ‚ç‚¹ä¹‹åæ’å…¥ï¼‰
  - è¾“å…¥æ–¹å¼åŒ `replace`
  - **ç»“æœ**ï¼šæ–°èŠ‚ç‚¹å æ®ä¸‹ä¸€ä¸ªç´¢å¼•ï¼ŒåŸèŠ‚ç‚¹ç´¢å¼•ä¸å˜

- `cr tree insert-child <namespace/definition> -p <path>` - æ’å…¥ä¸ºç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹

  - `-p <path>` - çˆ¶èŠ‚ç‚¹çš„è·¯å¾„
  - **ç»“æœ**ï¼šæ–°èŠ‚ç‚¹æˆä¸º `<path>,0`ï¼ŒåŸæœ‰å­èŠ‚ç‚¹ç´¢å¼•å…¨éƒ¨ +1

- `cr tree append-child <namespace/definition> -p <path>` - è¿½åŠ ä¸ºæœ€åä¸€ä¸ªå­èŠ‚ç‚¹

  - `-p <path>` - çˆ¶èŠ‚ç‚¹çš„è·¯å¾„
  - **ç»“æœ**ï¼šæ–°èŠ‚ç‚¹æˆä¸ºæœ€åä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œä¸å½±å“å…¶ä»–èŠ‚ç‚¹ç´¢å¼•
  - **æ¨è**ï¼šæ‰¹é‡æ’å…¥æ—¶ä¼˜å…ˆç”¨æ­¤å‘½ä»¤ï¼ˆç´¢å¼•ç¨³å®šï¼‰

- `cr tree swap-next <namespace/definition> -p <path>` - ä¸ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹äº¤æ¢ä½ç½®

  - `-p <path>` - å½“å‰èŠ‚ç‚¹è·¯å¾„
  - **ç»“æœ**ï¼šå½“å‰èŠ‚ç‚¹ç´¢å¼• +1ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹ç´¢å¼• -1
  - **åº”ç”¨åœºæ™¯**ï¼šè°ƒæ•´å‚æ•°é¡ºåºã€ç§»åŠ¨ä»£ç ä½ç½®

- `cr tree swap-prev <namespace/definition> -p <path>` - ä¸ä¸Šä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹äº¤æ¢ä½ç½®

  - `-p <path>` - å½“å‰èŠ‚ç‚¹è·¯å¾„
  - **ç»“æœ**ï¼šå½“å‰èŠ‚ç‚¹ç´¢å¼• -1ï¼Œä¸Šä¸€ä¸ªèŠ‚ç‚¹ç´¢å¼• +1

- `cr tree wrap <namespace/definition> -p <path>` - ç”¨æ–°ç»“æ„åŒ…è£…èŠ‚ç‚¹
  - `-p <path>` - è¦åŒ…è£…çš„èŠ‚ç‚¹è·¯å¾„
  - è¾“å…¥æ–¹å¼åŒ `replace`ï¼Œéœ€ä½¿ç”¨ `--refer-original <name>` å¼•ç”¨åŸèŠ‚ç‚¹
  - **ç¤ºä¾‹**ï¼šå°† `x` åŒ…è£…æˆ `(+ x 1)`
    ```bash
    cr tree wrap app.main/fn -p "2,0" -e '+ $original 1' --refer-original original
    ```

**å®æˆ˜ç¤ºä¾‹ï¼š**

```bash
# åœºæ™¯ 1ï¼šæŸ¥çœ‹å‡½æ•°ç»“æ„ï¼ˆæ¸è¿›å¼ï¼‰
cr tree show app.main/main! -p "" -d 1      # å…ˆçœ‹é¡¶å±‚
cr tree show app.main/main! -p "2" -d 2     # æ·±å…¥ç¬¬ 3 ä¸ªå­èŠ‚ç‚¹
cr tree show app.main/main! -p "2,1,0"      # æŸ¥çœ‹å…·ä½“èŠ‚ç‚¹

# åœºæ™¯ 2ï¼šæ›¿æ¢ç¬¦å· / å­—ç¬¦ä¸²ï¼ˆæ¨èç”¨ --leafï¼‰
cr tree replace app.main/add -p "2,0" --leaf -e '*'      # å°† + æ”¹æˆ *
cr tree replace app.main/greet -p "1" --leaf -e '|Hello' # æ›¿æ¢å­—ç¬¦ä¸² leaf

# åœºæ™¯ 3ï¼šæ›¿æ¢è¡¨è¾¾å¼
cr tree replace app.main/main! -p "2" -e 'println |modified'

# åœºæ™¯ 4ï¼šåˆ é™¤èŠ‚ç‚¹ï¼ˆæ³¨æ„ç´¢å¼•å˜åŒ–ï¼‰
cr query search "old-fn" -f app.main/main!  # æ‰¾åˆ° [3,2,5]
cr tree delete app.main/main! -p "3,2,5"

# åœºæ™¯ 5ï¼šæ‰¹é‡è¿½åŠ ï¼ˆå®‰å…¨æ–¹æ³•ï¼‰
cr tree append-child app.main/init! -p "2" -e 'step-1'
cr tree append-child app.main/init! -p "2" -e 'step-2'  # ç´¢å¼•ç¨³å®š
cr tree append-child app.main/init! -p "2" -e 'step-3'

# åœºæ™¯ 6ï¼šåŒ…è£…èŠ‚ç‚¹ï¼ˆæ·»åŠ å‡½æ•°è°ƒç”¨ï¼‰
cr tree wrap app.main/fn -p "3,1" -e 'str $old' --refer-original old
# å°† x å˜æˆ (str x)

# åœºæ™¯ 7ï¼šé…åˆ search å®šä½åæ›¿æ¢
cr query search ".show" -f app.comp.home/comp-box -l
# è¾“å‡ºï¼š[3,2,1,3,1,3,2,1,2,0] in .show confirm-plugin ...
cr tree show app.comp.home/comp-box -p "3,2,1,3,1,3,2,1,2,0"  # ç¡®è®¤
cr tree replace app.comp.home/comp-box -p "3,2,1,3,1,3,2,1,2,0" --leaf -e '|.visible'

# demos/compact.cirru å®æ“ï¼ˆéªŒè¯æœ€æ–° CLI è¾“å‡ºï¼‰
# ç›®æ ‡ï¼šæŠŠ `respo.app.core/new-fn` ä¸­çš„ `|hello` æš‚æ—¶æ”¹æˆå…¶ä»–æ–‡æ¡ˆï¼Œå†æ¢å¤
cr query search "println" -f respo.app.core/new-fn -l
# â†’ æ‰¾åˆ°è·¯å¾„ [3,0] / [3,1]
cr tree show respo.app.core/new-fn -p "3,1" -d 2
# â†’ CLI ä¼šæ˜¾ç¤º Location/Typeã€JSONã€ä¸‹ä¸€æ­¥æç¤º
cr tree replace respo.app.core/new-fn -p "3,1" --leaf -e '|hello from tree demo'
# â†’ è¾“å‡º `Preview: replace ...`ã€Before/After diffã€Verify æç¤º
cr tree replace respo.app.core/new-fn -p "3,1" --leaf -e '|hello'
# â†’ åŒæ ·ä¼šç»™å‡º diffï¼Œç¡®ä¿ demos æ¢å¤åŸçŠ¶
# ä»¥ä¸Šæµç¨‹é€‚åˆåœ¨ demos/compact.cirru åšæ²™ç›’æ“ä½œï¼Œç†Ÿæ‚‰è·¯å¾„ä¸ diff æç¤º
```

**âš ï¸ å®‰å…¨æ“ä½œæµç¨‹ï¼ˆå¿…è¯»ï¼‰**

**å•æ¬¡ä¿®æ”¹æ ‡å‡†æµç¨‹ï¼š**

```bash
# ã€æ­¥éª¤ 1ã€‘æ¨¡ç³Šæœç´¢å¿«é€Ÿå®šä½
cr query search "target" -f app.core/my-fn -l
# è¾“å‡ºï¼š[3,2,1,5] in target parent-context ...

# ã€æ­¥éª¤ 2ã€‘é€å±‚ç¡®è®¤è·¯å¾„æ­£ç¡®ï¼ˆé¿å…æ“ä½œé”™è¯¯èŠ‚ç‚¹ï¼‰
cr tree show app.core/my-fn -p "" -d 1        # æŸ¥çœ‹é¡¶å±‚ï¼Œç¡®è®¤ [3] å­˜åœ¨
cr tree show app.core/my-fn -p "3,2" -d 2     # æŸ¥çœ‹ä¸Šçº§ï¼Œç¡®è®¤ [3,2,1] å­˜åœ¨
cr tree show app.core/my-fn -p "3,2,1,5"      # æŸ¥çœ‹ç›®æ ‡èŠ‚ç‚¹å†…å®¹

# ã€æ­¥éª¤ 3ã€‘æ‰§è¡Œä¿®æ”¹
cr tree replace app.core/my-fn -p "3,2,1,5" --leaf -e '|new-value'

# ã€æ­¥éª¤ 4ã€‘éªŒè¯ä¿®æ”¹ç»“æœ
cr tree show app.core/my-fn -p "3,2,1,5"      # ç¡®è®¤å†…å®¹å·²æ›´æ–°
cr --check-only                                # è¯­æ³•æ£€æŸ¥
```

**æ‰¹é‡ä¿®æ”¹ç­–ç•¥ï¼š**

```bash
# âŒ é”™è¯¯ç¤ºèŒƒï¼šè¿ç»­åˆ é™¤ï¼ˆç´¢å¼•ä¼šå˜åŒ–ï¼‰
cr tree delete app.main/fn -p "3,2,1"
cr tree delete app.main/fn -p "3,2,2"  # é”™è¯¯ï¼è·¯å¾„å·²å¤±æ•ˆ

# âœ… æ­£ç¡®æ–¹æ³• Aï¼šä»åå¾€å‰æ“ä½œ
cr query search "pattern" -f app.main/fn  # è®°å½•æ‰€æœ‰è·¯å¾„
cr tree delete app.main/fn -p "3,2,3"     # å…ˆåˆ é™¤ç´¢å¼•å¤§çš„
cr tree delete app.main/fn -p "3,2,2"
cr tree delete app.main/fn -p "3,2,1"     # æœ€ååˆ é™¤ç´¢å¼•å°çš„

# âœ… æ­£ç¡®æ–¹æ³• Bï¼šå•æ¬¡æ“ä½œåç«‹å³é‡æ–°æœç´¢
cr tree delete app.main/fn -p "3,2,1"
cr query search "pattern" -f app.main/fn  # é‡æ–°è·å–è·¯å¾„
cr tree delete app.main/fn -p "<æ–°è·¯å¾„>"

# âœ… æ­£ç¡®æ–¹æ³• Cï¼šæ•´ä½“é‡å†™å®šä¹‰
cr query def app.main/fn > fn.json
# ç¼–è¾‘ fn.json
cr edit def app.main/fn -f fn.json -J
```

### ä»£ç ç¼–è¾‘ (`cr edit`)

ç›´æ¥ç¼–è¾‘ compact.cirru é¡¹ç›®ä»£ç ï¼Œæ”¯æŒä¸‰ç§è¾“å…¥æ–¹å¼ï¼š

- `--file <path>` æˆ– `-f <path>` - ä»æ–‡ä»¶è¯»å–ï¼ˆé»˜è®¤ Cirru æ ¼å¼ï¼Œä½¿ç”¨ `-J` æŒ‡å®š JSONï¼‰
- `--json <string>` æˆ– `-j <string>` - å†…è” JSON å­—ç¬¦ä¸²
- `--stdin` æˆ– `-s` - ä»æ ‡å‡†è¾“å…¥è¯»å–ï¼ˆé»˜è®¤ Cirru æ ¼å¼ï¼Œä½¿ç”¨ `-J` æŒ‡å®š JSONï¼‰

é¢å¤–æ”¯æŒâ€œå†…è”ä»£ç â€å‚æ•°ï¼š

- `--code <text>` æˆ– `-e <text>`ï¼šç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œä¼ å…¥ä¸€æ®µä»£ç ã€‚
  - é»˜è®¤æŒ‰ **Cirru å•è¡Œè¡¨è¾¾å¼ï¼ˆone-linerï¼‰** è§£æã€‚
  - å¦‚æœè¾“å…¥â€œçœ‹èµ·æ¥åƒ JSONâ€ï¼ˆä¾‹å¦‚ `-e '"abc"'`ï¼Œæˆ– `-e '["a"]'` è¿™ç±» `[...]` ä¸”åŒ…å« `"`ï¼‰ï¼Œåˆ™ä¼šæŒ‰ JSON è§£æã€‚
  - âš ï¸ å½“è¾“å…¥çœ‹èµ·æ¥åƒ JSON ä½† JSON ä¸åˆæ³•æ—¶ï¼Œä¼šç›´æ¥æŠ¥é”™ï¼ˆä¸ä¼šå›é€€å½“æˆ Cirru one-linerï¼‰ã€‚

å¯¹ `--file/--stdin` è¾“å…¥ï¼Œè¿˜æ”¯æŒä»¥ä¸‹â€œæ ¼å¼å¼€å…³â€ï¼ˆä¸ `-J/--json-input` ç±»ä¼¼ï¼‰ï¼š

- `--leaf`ï¼šæŠŠè¾“å…¥å½“æˆ **leaf èŠ‚ç‚¹**ï¼Œç›´æ¥ä½¿ç”¨ Cirru ç¬¦å·æˆ– `|text` å­—ç¬¦ä¸²ï¼Œæ— éœ€ JSON å¼•å·ã€‚
  - ä¼ å…¥ç¬¦å·ï¼š`-e 'my-symbol'`
  - ä¼ å…¥å­—ç¬¦ä¸²ï¼šåŠ  Cirru å­—ç¬¦ä¸²å‰ç¼€ `|` æˆ– `"`ï¼Œä¾‹å¦‚ `-e '|my string'` æˆ– `-e '"my string'`

âš ï¸ æ³¨æ„ï¼šè¿™äº›å¼€å…³å½¼æ­¤äº’æ–¥ï¼ˆä¸€æ¬¡åªç”¨ä¸€ä¸ªï¼‰ã€‚

**æ¨èç®€åŒ–è§„åˆ™ï¼ˆå‘½ä»¤è¡Œæ›´å¥½å†™ï¼‰ï¼š**

- **JSONï¼ˆå•è¡Œï¼‰**ï¼šä¼˜å…ˆç”¨ `-j '<json>'` æˆ– `-e '<json>'`ï¼ˆä¸éœ€è¦ `-J`ï¼‰ã€‚
- **Cirru å•è¡Œè¡¨è¾¾å¼**ï¼šç”¨ `-e '<expr>'`ï¼ˆ`-e` é»˜è®¤æŒ‰ one-liner è§£æï¼‰ã€‚
- **Cirru å¤šè¡Œç¼©è¿›**ï¼šç”¨ `-f file.cirru` æˆ– `-s`ï¼ˆstdinï¼‰ã€‚
- `-J/--json-input` ä¸»è¦ç”¨äº **file/stdin** è¯»å…¥ JSONï¼ˆå¦‚ `-f code.json -J` æˆ– `-s -J`ï¼‰ã€‚

è¡¥å……ï¼š`-e/--code` åªæœ‰åœ¨ `[...]` å†…éƒ¨åŒ…å« `"` æ—¶æ‰ä¼šè‡ªåŠ¨æŒ‰ JSON è§£æï¼ˆä¾‹å¦‚ `-e '["a"]'`ï¼‰ã€‚
åƒ `-e '[]'` / `-e '[ ]'` ä¼šé»˜è®¤æŒ‰ Cirru one-liner å¤„ç†ï¼›å¦‚æœä½ éœ€è¦â€œç©º JSON æ•°ç»„â€ï¼Œç”¨æ˜¾å¼ JSONï¼š`-j '[]'`ã€‚

å¦‚æœä½ æƒ³åœ¨å‘½ä»¤è¡Œé‡Œæ˜ç¡®â€œè¿™æ®µå°±æ˜¯ JSONâ€ï¼Œè¯·ç”¨ `-j '<json>'`ï¼ˆ`-J` æ˜¯ç»™ file/stdin ç”¨çš„ï¼‰ã€‚

**å®šä¹‰æ“ä½œï¼š**

- `cr edit def <namespace/definition>` - æ·»åŠ æˆ–æ›´æ–°å®šä¹‰
- `cr edit rm-def <namespace/definition>` - åˆ é™¤å®šä¹‰
- `cr edit doc <namespace/definition> '<doc>'` - æ›´æ–°å®šä¹‰çš„æ–‡æ¡£
- `cr edit examples <namespace/definition>` - è®¾ç½®å®šä¹‰çš„ç¤ºä¾‹ä»£ç ï¼ˆæ‰¹é‡æ›¿æ¢ï¼‰
- `cr edit add-example <namespace/definition>` - æ·»åŠ å•ä¸ªç¤ºä¾‹
- `cr edit rm-example <namespace/definition> <index>` - åˆ é™¤æŒ‡å®šç´¢å¼•çš„ç¤ºä¾‹ï¼ˆ0-basedï¼‰

**å‘½åç©ºé—´æ“ä½œï¼š**

- `cr edit add-ns <namespace>` - æ·»åŠ å‘½åç©ºé—´
- `cr edit rm-ns <namespace>` - åˆ é™¤å‘½åç©ºé—´
- `cr edit imports <namespace>` - æ›´æ–°å¯¼å…¥è§„åˆ™ï¼ˆå…¨é‡æ›¿æ¢ï¼‰
- `cr edit add-import <namespace>` - æ·»åŠ å•ä¸ª import è§„åˆ™
- `cr edit rm-import <namespace> <source_ns>` - ç§»é™¤æŒ‡å®šæ¥æºçš„ import è§„åˆ™
- `cr edit ns-doc <namespace> '<doc>'` - æ›´æ–°å‘½åç©ºé—´æ–‡æ¡£

**æ¨¡å—å’Œé…ç½®ï¼š**

- `cr edit add-module <module-path>` - æ·»åŠ æ¨¡å—ä¾èµ–
- `cr edit rm-module <module-path>` - åˆ é™¤æ¨¡å—ä¾èµ–
- `cr edit config <key> <value>` - è®¾ç½®é…ç½®ï¼ˆkey: init-fn, reload-fn, versionï¼‰

**å¢é‡å˜æ›´å¯¼å‡ºï¼š**

- `cr edit inc` - æè¿°å¢é‡ä»£ç å˜æ›´å¹¶å¯¼å‡ºåˆ° `.compact-inc.cirru`
  - `--added "namespace/definition"` - æ ‡è®°æ–°å¢çš„å®šä¹‰
  - `--changed "namespace/definition"` - æ ‡è®°ä¿®æ”¹çš„å®šä¹‰
  - `--removed "namespace/definition"` - æ ‡è®°åˆ é™¤çš„å®šä¹‰
  - `--added-ns "namespace"` - æ ‡è®°æ–°å¢çš„å‘½åç©ºé—´
  - `--removed-ns "namespace"` - æ ‡è®°åˆ é™¤çš„å‘½åç©ºé—´
  - `--ns-updated "namespace"` - æ ‡è®°å‘½åç©ºé—´å¯¼å…¥å˜æ›´
  - é…åˆ watcher ä½¿ç”¨å®ç°çƒ­æ›´æ–°ï¼ˆè¯¦è§"å¼€å‘è°ƒè¯•"ç« èŠ‚ï¼‰

ä½¿ç”¨ `--help` å‚æ•°äº†è§£è¯¦ç»†çš„è¾“å…¥æ–¹å¼å’Œå‚æ•°é€‰é¡¹ã€‚

---

## Calcit è¯­è¨€åŸºç¡€

### Cirru è¯­æ³•æ ¸å¿ƒæ¦‚å¿µ

**ä¸å…¶ä»– Lisp çš„åŒºåˆ«ï¼š**

- **ç¼©è¿›è¯­æ³•**ï¼šç”¨ç¼©è¿›ä»£æ›¿æ‹¬å·ï¼ˆç±»ä¼¼ Python/YAMLï¼‰ï¼Œå•è¡Œç”¨ç©ºæ ¼åˆ†éš”
- **å­—ç¬¦ä¸²å‰ç¼€**ï¼š`|hello` æˆ– `"hello"` è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œ`|` å‰ç¼€æ›´ç®€æ´
- **æ— æ–¹æ‹¬å·èŠ±æ‹¬å·**ï¼šåªç”¨åœ†æ‹¬å·æ¦‚å¿µï¼ˆä½“ç°åœ¨ JSON è½¬æ¢ä¸­ï¼‰ï¼ŒCirru æ–‡æœ¬å±‚é¢æ— æ‹¬å·

**å¸¸è§æ··æ·†ç‚¹ï¼š**

âŒ **é”™è¯¯ç†è§£ï¼š** Calcit å­—ç¬¦ä¸²æ˜¯ `"x"` â†’ JSON æ˜¯ `"\"x\""`  
âœ… **æ­£ç¡®ç†è§£ï¼š** Cirru `|x` â†’ JSON `"x"`ï¼ŒCirru `"x"` â†’ JSON `"x"`

**ç¤ºä¾‹å¯¹ç…§ï¼š**

| Cirru ä»£ç        | JSON ç­‰ä»·                        | JavaScript ç­‰ä»·          |
| ---------------- | -------------------------------- | ------------------------ |
| `\|hello`        | `"hello"`                        | `"hello"`                |
| `"world"`        | `"world"`                        | `"world"`                |
| `\|a b c`        | `"a b c"`                        | `"a b c"`                |
| `fn (x) (+ x 1)` | `["fn", ["x"], ["+", "x", "1"]]` | `fn(x) { return x + 1 }` |

### æ•°æ®ç»“æ„ï¼šTuple vs Vector

Calcit ç‰¹æœ‰çš„ä¸¤ç§åºåˆ—ç±»å‹ï¼š

**Tuple (`::`)** - ä¸å¯å˜ã€ç”¨äºæ¨¡å¼åŒ¹é…

```cirru
; åˆ›å»º tuple
:: :event/type data

; æ¨¡å¼åŒ¹é…
tag-match event
  (:event/click data) (handle-click data)
  (:event/input text) (handle-input text)
```

**Vector (`[]`)** - å¯å˜ã€ç”¨äºåˆ—è¡¨æ“ä½œ

```cirru
; åˆ›å»º vector
[] item1 item2 item3

; DOM åˆ—è¡¨
div {} $ []
  button {} |Click
  span {} |Text
```

**å¸¸è§é”™è¯¯ï¼š**

```cirru
; âŒ é”™è¯¯ï¼šç”¨ vector ä¼ äº‹ä»¶
send-event! $ [] :clipboard/read text
; æŠ¥é”™ï¼štag-match expected tuple

; âœ… æ­£ç¡®ï¼šç”¨ tuple
send-event! $ :: :clipboard/read text
```

### å…¶ä»–æ˜“é”™ç‚¹

æ¯”è¾ƒå®¹æ˜“çŠ¯çš„é”™è¯¯ï¼š

- Calcit ä¸­å­—ç¬¦ä¸²é€šè¿‡å‰ç¼€åŒºåˆ†ï¼Œ`|` å’Œ `"` å¼€å¤´è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚`|x` å¯¹åº” JavaScript å­—ç¬¦ä¸² `"x"`ã€‚äº§ç”Ÿ JSON æ—¶æ³¨æ„ä¸è¦é‡å¤åŒ…è£¹å¼•å·ã€‚
- Calcit é‡‡ç”¨ Cirru ç¼©è¿›è¯­æ³•ï¼Œå¯ä»¥ç†è§£æˆå»æ‰è·¨è¡Œæ‹¬å·æ”¹ç”¨ç¼©è¿›çš„ Lisp å˜ç§ã€‚ç”¨ `cr cirru parse` å’Œ `cr cirru format` äº’ç›¸è½¬åŒ–è¯•éªŒã€‚
- Calcit è·Ÿ Clojure åœ¨è¯­ä¹‰ä¸Šæ¯”è¾ƒåƒï¼Œä½†è¯­æ³•å±‚é¢åªç”¨åœ†æ‹¬å·ï¼Œä¸ç”¨æ–¹æ‹¬å·èŠ±æ‹¬å·ã€‚

---

## å¼€å‘è°ƒè¯•

ç®€å•è„šæœ¬ç”¨ `cr -1 <filepath>` ç›´æ¥æ‰§è¡Œã€‚ç¼–è¯‘ JavaScript ç”¨ `cr -1 <filepath> js` æ‰§è¡Œä¸€æ¬¡ç¼–è¯‘ã€‚

Calcit snapshot æ–‡ä»¶ä¸­ config æœ‰ `init-fn` å’Œ `reload-fn` é…ç½®ï¼š

- åˆæ¬¡å¯åŠ¨è°ƒç”¨ `init-fn`
- æ¯æ¬¡ä¿®æ”¹ä»£ç åè°ƒç”¨ `reload-fn`

**å…¸å‹å¼€å‘æµç¨‹ï¼š**

```bash
# 1. æ£€æŸ¥ä»£ç æ­£ç¡®æ€§
cr --check-only

# 2. æ‰§è¡Œç¨‹åºï¼ˆä¸€æ¬¡æ€§ï¼‰
cr -1

# 3. ç¼–è¯‘ JavaScriptï¼ˆä¸€æ¬¡æ€§ï¼‰
cr -1 js

# 4. è¿›å…¥ç›‘å¬æ¨¡å¼å¼€å‘
cr        # è§£é‡Šæ‰§è¡Œæ¨¡å¼
cr js     # JS ç¼–è¯‘æ¨¡å¼
```

### å¢é‡è§¦å‘æ›´æ–°ï¼ˆæ¨èï¼‰â­â­â­

å½“ä½¿ç”¨ç›‘å¬æ¨¡å¼ï¼ˆ`cr` æˆ– `cr js`ï¼‰å¼€å‘æ—¶ï¼Œæ¨èä½¿ç”¨ `cr edit inc` å‘½ä»¤è§¦å‘å¢é‡æ›´æ–°ï¼Œè€Œéå…¨é‡é‡æ–°ç¼–è¯‘/æ‰§è¡Œï¼š

**å·¥ä½œæµç¨‹ï¼š**

```bash
# ã€ç»ˆç«¯ 1ã€‘å¯åŠ¨ watcherï¼ˆç›‘å¬æ¨¡å¼ï¼‰
cr        # æˆ– cr js

# ã€ç»ˆç«¯ 2ã€‘ä¿®æ”¹ä»£ç åè§¦å‘å¢é‡æ›´æ–°
# ä¿®æ”¹å®šä¹‰
cr edit def app.core/my-fn -e 'defn my-fn (x) (+ x 1)'

# è§¦å‘å¢é‡æ›´æ–°
cr edit inc --changed "app.core/my-fn"

# ç­‰å¾… ~300ms åæŸ¥çœ‹ç¼–è¯‘ç»“æœ
cr query error
```

**å¢é‡æ›´æ–°å‘½ä»¤å‚æ•°ï¼š**

```bash
# æ–°å¢å®šä¹‰
cr edit inc --added "namespace/definition"

# ä¿®æ”¹å®šä¹‰
cr edit inc --changed "namespace/definition"

# åˆ é™¤å®šä¹‰
cr edit inc --removed "namespace/definition"

# æ–°å¢å‘½åç©ºé—´
cr edit inc --added-ns "namespace"

# åˆ é™¤å‘½åç©ºé—´
cr edit inc --removed-ns "namespace"

# æ›´æ–°å‘½åç©ºé—´å¯¼å…¥
cr edit inc --ns-updated "namespace"

# ç»„åˆä½¿ç”¨ï¼ˆæ‰¹é‡æ›´æ–°ï¼‰
cr edit inc \
  --changed "app.core/add" \
  --changed "app.core/multiply" \
  --removed "app.core/old-fn"
```

**æŸ¥çœ‹ç¼–è¯‘ç»“æœï¼š**

```bash
# æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
cr query error

# è¾“å‡ºæƒ…å†µï¼š
# - æ–‡ä»¶ä¸å­˜åœ¨ â†’ æç¤º "No .calcit-error.cirru file found"ï¼ˆé»„è‰²ï¼‰
# - æ–‡ä»¶ä¸ºç©º â†’ æç¤º "Error file is empty (no recent errors)"ï¼ˆç»¿è‰²ï¼Œè¡¨ç¤ºç¼–è¯‘æˆåŠŸï¼‰
# - æœ‰é”™è¯¯ â†’ æ˜¾ç¤ºå®Œæ•´é”™è¯¯å †æ ˆå’Œä½ç½®ä¿¡æ¯ï¼ˆçº¢è‰²ï¼‰
```

**ä½•æ—¶ä½¿ç”¨å…¨é‡æ“ä½œï¼š**

```bash
# å¤§é‡ä¿®æ”¹æˆ–éœ€è¦å®Œå…¨åˆ·æ–°æ—¶
cr --check-only    # å¿«é€Ÿè¯­æ³•æ£€æŸ¥
cr -1              # é‡æ–°æ‰§è¡Œç¨‹åº
cr -1 js           # é‡æ–°ç¼–è¯‘ JavaScript

# æˆ–é‡å¯ç›‘å¬æ¨¡å¼
# Ctrl+C åœæ­¢ watcherï¼Œç„¶åé‡æ–°è¿è¡Œï¼š
cr        # æˆ– cr js
```

**å¢é‡æ›´æ–°çš„ä¼˜åŠ¿ï¼š**

- âš¡ **å¿«é€Ÿåé¦ˆ**ï¼šåªå¤„ç†ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªç¨‹åº
- ğŸ¯ **ç²¾ç¡®æ§åˆ¶**ï¼šæ˜ç¡®æŒ‡å®šå“ªäº›å®šä¹‰å‘ç”Ÿäº†å˜åŒ–
- ğŸ” **é”™è¯¯éš”ç¦»**ï¼šé€šè¿‡ `cr query error` å¿«é€ŸæŸ¥çœ‹ç‰¹å®šä¿®æ”¹å¼•èµ·çš„é”™è¯¯
- ğŸ”„ **ä¿æŒçŠ¶æ€**ï¼šwatcher æŒç»­è¿è¡Œï¼Œä¿æŒç¨‹åºè¿è¡Œæ—¶çŠ¶æ€ï¼ˆé€‚ç”¨äºæœ‰çŠ¶æ€çš„åº”ç”¨ï¼‰

---

## æ–‡æ¡£æ”¯æŒ

é‡åˆ°ç–‘é—®æ—¶ä½¿ç”¨ï¼š

- `cr docs search <keyword>` - æœç´¢ Calcit æ•™ç¨‹å†…å®¹
- `cr docs read <filename>` - é˜…è¯»å®Œæ•´æ–‡æ¡£
- `cr docs list` - æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ–‡æ¡£
- `cr query ns <ns>` - æŸ¥çœ‹å‘½åç©ºé—´è¯´æ˜å’Œå‡½æ•°æ–‡æ¡£
- `cr query peek <ns/def>` - å¿«é€ŸæŸ¥çœ‹å®šä¹‰ç­¾å
- `cr query def <ns/def>` - è¯»å–å®Œæ•´è¯­æ³•æ ‘
- `cr query examples <ns/def>` - æŸ¥çœ‹ç¤ºä¾‹ä»£ç 
- `cr query find <name>` - è·¨å‘½åç©ºé—´æœç´¢ç¬¦å·
- `cr query usages <ns/def>` - æŸ¥æ‰¾å®šä¹‰çš„ä½¿ç”¨ä½ç½®
- `cr query search <ns/def> -p <pattern>` - æœç´¢å¶å­èŠ‚ç‚¹
- `cr query search-pattern <ns/def> -p <pattern>` - æœç´¢ç»“æ„æ¨¡å¼
- `cr query error` - æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯å †æ ˆ

---

## ä»£ç ä¿®æ”¹ç¤ºä¾‹

**æ·»åŠ æ–°å‡½æ•°ï¼š**

```bash
# Cirru one liner
cr edit def app.core/multiply -e 'defn multiply (x y) (* x y)'
# or JSON
cr edit def app.core/multiply -j '["defn", "multiply", ["x", "y"], ["*", "x", "y"]]'
```

**æ›´æ–°æ–‡æ¡£å’Œç¤ºä¾‹ï¼š**

```bash
# æ›´æ–°æ–‡æ¡£
cr edit doc app.core/multiply 'ä¹˜æ³•å‡½æ•°ï¼Œè¿”å›ä¸¤ä¸ªæ•°çš„ç§¯'

# è®¾ç½®ç¤ºä¾‹
cr edit examples app.core/multiply -j '[["multiply", "3", "4"]]'

# æ·»åŠ ç¤ºä¾‹
cr edit add-example app.core/multiply -e 'multiply 5 6'

# åˆ é™¤ç¤ºä¾‹
cr edit rm-example app.core/multiply 1
```

**å±€éƒ¨ä¿®æ”¹ï¼ˆæ¨èæµç¨‹ï¼‰ï¼š**

```bash
# 1. è¯»å–å®Œæ•´å®šä¹‰
cr query def app.core/add-numbers

# 2. å¤šæ¬¡æŸ¥çœ‹èŠ‚ç‚¹ç¡®è®¤ç›®æ ‡åæ ‡
cr tree show app.core/add-numbers -p "" -d 1
cr tree show app.core/add-numbers -p "2" -d 1
cr tree show app.core/add-numbers -p "2,0"

# 3. æ‰§è¡Œæ›¿æ¢
cr tree replace app.core/add-numbers -p "2,0" -e '*'

# 4. éªŒè¯
cr tree show app.core/add-numbers -p "2"
```

**å‘½åç©ºé—´å¢é‡æ“ä½œï¼š**

```bash
# æ·»åŠ å‘½åç©ºé—´
cr edit add-ns app.util

# æ·»åŠ å¯¼å…¥è§„åˆ™
cr edit add-import app.main -e 'app.util :refer $ helper'

# ç§»é™¤å¯¼å…¥è§„åˆ™
cr edit rm-import app.main app.util

# æ›´æ–°é¡¹ç›®é…ç½®
cr edit config init-fn app.main/main!
```

**æ›´æ–°å‘½åç©ºé—´å¯¼å…¥ï¼ˆå…¨é‡æ›¿æ¢ï¼‰ï¼š**

```bash
cr edit imports app.main -j '[["app.lib", ":as", "lib"], ["app.util", ":refer", ["helper"]]]'
```

---

## âš ï¸ å¸¸è§é™·é˜±å’Œæœ€ä½³å®è·µ

### 1. è·¯å¾„ç´¢å¼•åŠ¨æ€å˜åŒ–é—®é¢˜ â­â­â­

**æ ¸å¿ƒé—®é¢˜ï¼š** åˆ é™¤æˆ–æ’å…¥èŠ‚ç‚¹åï¼ŒåŒçº§åç»­èŠ‚ç‚¹çš„ç´¢å¼•ä¼šè‡ªåŠ¨æ”¹å˜ï¼Œå¯¼è‡´ä¹‹å‰æŸ¥è¯¢åˆ°çš„è·¯å¾„ç«‹å³å¤±æ•ˆã€‚

**å…¸å‹é”™è¯¯ï¼š**

```bash
# å‡è®¾æœç´¢åˆ°ä¸¤ä¸ªèŠ‚ç‚¹ï¼š[3,2,1,2] å’Œ [3,2,1,3]
cr tree delete app.main/fn -p "3,2,1,2"
# æ­¤æ—¶åŸæ¥çš„ [3,2,1,3] å·²å˜æˆ [3,2,1,2]
cr tree delete app.main/fn -p "3,2,1,3"  # âŒ è·¯å¾„å·²å¤±æ•ˆï¼ŒæŠ¥é”™ï¼
```

**è§£å†³æ–¹æ¡ˆï¼š**

âœ… **ä»åå¾€å‰æ“ä½œ** - å…ˆæ“ä½œç´¢å¼•å¤§çš„èŠ‚ç‚¹ï¼š

```bash
# æ­£ç¡®é¡ºåºï¼šä»åå¾€å‰åˆ é™¤
cr tree delete app.main/fn -p "3,2,1,3"
cr tree delete app.main/fn -p "3,2,1,2"
cr tree delete app.main/fn -p "3,2,1,1"
```

âœ… **å•æ¬¡æ“ä½œåç«‹å³é‡æ–°æœç´¢ï¼š**

```bash
cr tree delete app.main/fn -p "3,2,1,2"
# ç«‹å³é‡æ–°æœç´¢è·å–æ›´æ–°åçš„è·¯å¾„
cr query search "target" -f app.main/fn
cr tree delete app.main/fn -p "<æ–°è·¯å¾„>"
```

âœ… **æ‰¹é‡æ“ä½œå‰ä¸€æ¬¡æ€§è§„åˆ’ï¼š**

```bash
# 1. å…ˆæ”¶é›†æ‰€æœ‰éœ€è¦ä¿®æ”¹çš„è·¯å¾„
cr query search "old-pattern" -f app.main/fn > paths.txt
# 2. æ‰‹åŠ¨æ’åºåä»åå¾€å‰æ‰§è¡Œ
# 3. æˆ–è€ƒè™‘ç”¨ cr edit def æ•´ä½“é‡å†™å®šä¹‰
```

âš ï¸ **é¿å…ï¼š** åŸºäºå•æ¬¡æœç´¢ç»“æœè¿ç»­ä¿®æ”¹å¤šä¸ªèŠ‚ç‚¹ã€‚

### 2. è¾“å…¥æ ¼å¼å‚æ•°ä½¿ç”¨é€ŸæŸ¥ â­â­â­

**å‚æ•°æ··æ·†çŸ©é˜µï¼ˆå·²å…¨é¢æ”¯æŒ `-e` è‡ªåŠ¨è¯†åˆ«ï¼‰ï¼š**

| åœºæ™¯                | ç¤ºä¾‹ç”¨æ³•                               | è§£æç»“æœ                      | è¯´æ˜                              |
| ------------------- | -------------------------------------- | ----------------------------- | --------------------------------- |
| **è¡¨è¾¾å¼ (Cirru)**  | `-e 'defn add (a b) (+ a b)'`          | `["defn", "add", ...]` (List) | é»˜è®¤æŒ‰ Cirru one-liner è§£æ       |
| **åŸå­ç¬¦å· (Leaf)** | `--leaf -e 'my-symbol'`                | `"my-symbol"` (Leaf)          | **æ¨è**ï¼Œé¿å…è¢«åŒ…è£…æˆ list       |
| **å­—ç¬¦ä¸² (Leaf)**   | `--leaf -e '\|hello world'`            | `"hello world"` (Leaf)        | ç¬¦å·å‰ç¼€ `\|` è¡¨ç¤ºå­—ç¬¦ä¸²          |
| **JSON æ•°ç»„**       | `-e '["+", "x", "1"]'`                 | `["+", "x", "1"]` (List)      | **è‡ªåŠ¨è¯†åˆ«** (å« `[` ä¸”æœ‰ `"`)    |
| **JSON å­—ç¬¦ä¸²**     | `-e '"my leaf"'`                       | `"my leaf"` (Leaf)            | **è‡ªåŠ¨è¯†åˆ«** (å«å¼•ç”¨çš„å­—ç¬¦ä¸²)     |
| **å†…è” JSON**       | `-j '["defn", ...]'`                   | `["defn", ...]` (List)        | æ˜¾å¼æŒ‰ JSON è§£æï¼Œå¿½ç•¥ Cirru è§„åˆ™ |
| **å¤–éƒ¨æ–‡ä»¶**        | `-f code.cirru` (æˆ– `-f code.json -J`) | æ ¹æ®æ–‡ä»¶å†…å®¹è§£æ              | `-J` ç”¨äºæ ‡è®°æ–‡ä»¶å†…æ˜¯ JSON        |

**æ ¸å¿ƒè§„åˆ™ï¼š**

1. **æ™ºèƒ½è¯†åˆ«æ¨¡å¼**ï¼š`-e / --code` ç°åœ¨ä¼šè‡ªåŠ¨è¯†åˆ« JSONã€‚å¦‚æœä½ ä¼ å…¥ `["a"]` æˆ– `"a"`ï¼Œå®ƒä¼šç›´æ¥æŒ‰ JSON å¤„ç†ï¼Œæ— éœ€å†é¢å¤–åŠ  `-J` æˆ– `-j`ã€‚
2. **å¼ºåˆ¶ Leaf æ¨¡å¼**ï¼šå¦‚æœä½ éœ€è¦ç¡®ä¿è¾“å…¥æ˜¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆç¬¦å·æˆ–å­—ç¬¦ä¸²ï¼‰ï¼Œè¯·åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ `--leaf` å¼€å…³ã€‚å®ƒä¼šå°†åŸå§‹è¾“å…¥ç›´æ¥ä½œä¸ºå†…å®¹ï¼Œä¸ç»è¿‡ä»»ä½•è§£æã€‚
3. **æ˜¾å¼ JSON æ¨¡å¼**ï¼šå¦‚æœä½ æƒ³æ˜ç¡®å‘Šè¯‰å·¥å…·â€œè¿™æ®µå°±æ˜¯ JSONâ€ï¼Œä¼˜å…ˆç”¨ `-j '<json>'`ã€‚
4. **ç»Ÿä¸€æ€§**ï¼š`cr tree` å’Œ `cr edit` çš„æ‰€æœ‰å­å‘½ä»¤ï¼ˆreplace, def, insert ç­‰ï¼‰ç°åœ¨å…±äº«å®Œå…¨ç›¸åŒçš„è¾“å…¥è§£æé€»è¾‘ã€‚

**å®æˆ˜ç¤ºä¾‹ï¼š**

```bash
# âœ… æ›¿æ¢è¡¨è¾¾å¼
cr tree replace app.main/fn -p "2" -e 'println |hello'

# âœ… æ›¿æ¢ leafï¼ˆæ¨è --leafï¼‰
cr tree replace app.main/fn -p "2,0" --leaf -e 'new-symbol'

# âœ… æ›¿æ¢å­—ç¬¦ä¸² leaf
cr tree replace app.main/fn -p "2,1" --leaf -e '|new text'

# âŒ é¿å…ï¼šç”¨ -e ä¼ å•ä¸ª tokenï¼ˆä¼šå˜æˆ listï¼‰
cr tree replace app.main/fn -p "2,0" -e 'symbol'  # ç»“æœï¼š["symbol"]
```

### 3. Cirru å­—ç¬¦ä¸²å’Œæ•°æ®ç±»å‹ â­â­

**Cirru å­—ç¬¦ä¸²å‰ç¼€ï¼š**

| Cirru å†™æ³•     | JSON ç­‰ä»·      | ä½¿ç”¨åœºæ™¯     |
| -------------- | -------------- | ------------ |
| `\|hello`      | `"hello"`      | æ¨èï¼Œç®€æ´   |
| `"hello"`      | `"hello"`      | ä¹Ÿå¯ä»¥       |
| `\|a b c`      | `"a b c"`      | åŒ…å«ç©ºæ ¼     |
| `\|[tag] text` | `"[tag] text"` | åŒ…å«ç‰¹æ®Šå­—ç¬¦ |

**Tuple vs Vectorï¼š**

```cirru
; âœ… Tuple - ç”¨äºäº‹ä»¶ã€æ¨¡å¼åŒ¹é…
:: :clipboard/read text

; âœ… Vector - ç”¨äº DOM åˆ—è¡¨
[] (button) (div)

; âŒ é”™è¯¯ï¼šç”¨ vector ä¼ äº‹ä»¶
send-to-component! $ [] :clipboard/read text
; æŠ¥é”™ï¼štag-match expected tuple

; âœ… æ­£ç¡®ï¼šç”¨ tuple
send-to-component! $ :: :clipboard/read text
```

**è®°å¿†è§„åˆ™ï¼š**

- **`::` (tuple)**: äº‹ä»¶ã€æ¨¡å¼åŒ¹é…ã€ä¸å¯å˜æ•°æ®ç»“æ„
- **`[]` (vector)**: DOM å…ƒç´ åˆ—è¡¨ã€åŠ¨æ€é›†åˆ

### 4. æœç´¢ç»“æœè·¯å¾„çš„æ­£ç¡®ä½¿ç”¨ â­

**æœç´¢è¾“å‡ºæ ¼å¼ï¼š**

```bash
cr query search ".show" -f app.comp.home/comp-box
# è¾“å‡ºï¼š[3,2,1,3,1,3,2,1,2,0] in .show confirm-plugin d! (fn () ...)
#       ^^^^^^^^^^^^^^^^^^^^^^ è¿™æ˜¯ .show èŠ‚ç‚¹æœ¬èº«çš„è·¯å¾„
#                              çˆ¶çº§è·¯å¾„æ˜¯ [3,2,1,3,1,3,2,1,2]
```

**ä½¿ç”¨å»ºè®®ï¼š**

- **æŸ¥çœ‹èŠ‚ç‚¹**ï¼šç”¨è¿”å›çš„å®Œæ•´è·¯å¾„
  ```bash
  cr tree show app.comp.home/comp-box -p "3,2,1,3,1,3,2,1,2,0"
  ```
- **æ›¿æ¢èŠ‚ç‚¹**ï¼šç”¨çˆ¶çº§è·¯å¾„ï¼ˆå»æ‰æœ€åä¸€ä¸ªç´¢å¼•ï¼‰
  ```bash
  cr tree replace app.comp.home/comp-box -p "3,2,1,3,1,3,2,1,2" -e 'new-expr'
  ```
- **æ’å…¥/åˆ é™¤**ï¼šæ ¹æ®æ“ä½œç±»å‹é€‰æ‹©è·¯å¾„

  ```bash
  # åˆ é™¤èŠ‚ç‚¹æœ¬èº«ï¼šç”¨å®Œæ•´è·¯å¾„
  cr tree delete app.comp.home/comp-box -p "3,2,1,3,1,3,2,1,2,0"

  # åœ¨èŠ‚ç‚¹åæ’å…¥ï¼šç”¨å®Œæ•´è·¯å¾„
  cr tree insert-after app.comp.home/comp-box -p "3,2,1,3,1,3,2,1,2,0" -e 'new-item'
  ```

### 5. æ¨èå·¥ä½œæµç¨‹

**ç²¾ç»†ä»£ç ä¿®æ”¹æµç¨‹ï¼š**

```bash
# ã€æ­¥éª¤ 1ã€‘æ¨¡ç³Šæœç´¢å®šä½å¤§è‡´ä½ç½®
cr query search "target-keyword" -f namespace/definition -l

# ã€æ­¥éª¤ 2ã€‘é€å±‚ç¡®è®¤ç²¾ç¡®è·¯å¾„ï¼ˆå¤šæ¬¡è¿è¡Œï¼Œé€æ­¥æ·±å…¥ï¼‰
cr tree show namespace/definition -p "" -d 1
cr tree show namespace/definition -p "3" -d 2
cr tree show namespace/definition -p "3,2,1" -d 2

# ã€æ­¥éª¤ 3ã€‘æ‰§è¡Œä¿®æ”¹ï¼ˆå•æ¬¡æ“ä½œï¼‰
cr tree replace namespace/definition -p "3,2,1" -e 'new-code'

# ã€æ­¥éª¤ 4ã€‘éªŒè¯ç»“æœ
cr tree show namespace/definition -p "3,2,1"
cr --check-only  # è¯­æ³•æ£€æŸ¥
```

**æ‰¹é‡ä¿®æ”¹ç­–ç•¥ï¼š**

```bash
# æ–¹æ¡ˆ Aï¼šä»åå¾€å‰æ“ä½œ
# 1. æ”¶é›†æ‰€æœ‰è·¯å¾„å¹¶æ’åº
cr query search "pattern" -f app.main/fn
# è®°å½•ï¼š[2,1,3], [2,1,2], [2,1,1]

# 2. ä»å¤§åˆ°å°æ‰§è¡Œ
cr tree delete app.main/fn -p "2,1,3"
cr tree delete app.main/fn -p "2,1,2"
cr tree delete app.main/fn -p "2,1,1"

# æ–¹æ¡ˆ Bï¼šæ•´ä½“é‡å†™
cr query def app.main/fn > fn.json
# ç¼–è¾‘ fn.json
cr edit def app.main/fn -f fn.json -J
```

---

## å¸¸è§é”™è¯¯æ’æŸ¥

| é”™è¯¯ä¿¡æ¯                            | åŸå›                                 | è§£å†³æ–¹æ³•                                        |
| ----------------------------------- | ----------------------------------- | ----------------------------------------------- |
| `Path index X out of bounds`        | è·¯å¾„å·²è¿‡æœŸï¼ŒèŠ‚ç‚¹è¢«åˆ é™¤æˆ–ç´¢å¼•æ”¹å˜    | é‡æ–°è¿è¡Œ `cr query search` è·å–æœ€æ–°è·¯å¾„         |
| `tag-match expected tuple, got ...` | ä¼ å…¥ vector `[]` è€Œé tuple `::`    | æ”¹ç”¨ `::` æ„é€ æ•°æ®ç»“æ„                          |
| å­—ç¬¦ä¸²è¢«æ‹†åˆ†æˆå¤šä¸ª token            | Cirru å­—ç¬¦ä¸²æ²¡æœ‰ç”¨ `\|` æˆ– `"` åŒ…è£¹ | ä½¿ç”¨ `\|complete string` æˆ– `"complete string"` |
| Cirru one-liner å˜æˆ list           | `-e` å•ä¸ª token ä¼šè¢«åŒ…è£…æˆ list     | ç”¨ `-j '"token"'` ä¼ å…¥ leaf èŠ‚ç‚¹                |
| `unexpected format in expression`   | JSON æ ¼å¼é”™è¯¯æˆ– Cirru è¯­æ³•é”™è¯¯      | ç”¨ `cr cirru parse '<code>'` éªŒè¯è¯­æ³•           |

**è°ƒè¯•æŠ€å·§ï¼š**

```bash
# 1. éªŒè¯ Cirru è¯­æ³•
cr cirru parse 'fn (x) (+ x 1)'

# 2. éªŒè¯ JSON æ ¼å¼
echo '["fn", ["x"], ["+", "x", "1"]]' | jq .

# 3. æ£€æŸ¥æ•´ä½“è¯­æ³•
cr --check-only

# 4. æŸ¥çœ‹é”™è¯¯å †æ ˆ
cr query error
```
