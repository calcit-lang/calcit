# Calcit ç¼–ç¨‹ Agent æŒ‡å—

æœ¬æ–‡æ¡£ä¸º AI Agent æä¾› Calcit é¡¹ç›®çš„æ“ä½œæŒ‡å—ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆæ–° LLM å¿…è¯»ï¼‰

**æ ¸å¿ƒåŸåˆ™ï¼šç”¨å‘½ä»¤è¡Œå·¥å…·ï¼ˆä¸è¦ç›´æ¥ç¼–è¾‘æ–‡ä»¶ï¼‰ï¼Œç”¨ search å®šä½ï¼ˆæ¯”é€å±‚å¯¼èˆªå¿« 10 å€ï¼‰**

### æ ‡å‡†æµç¨‹

```bash
# æœç´¢ â†’ ä¿®æ”¹ â†’ éªŒè¯
cr query search 'symbol' -f 'ns/def'                      # 1. å®šä½ï¼ˆè¾“å‡ºï¼š[3,2,1] in ...ï¼‰
cr tree replace 'ns/def' -p '3,2,1' --leaf -e 'new'     # 2. ä¿®æ”¹
cr tree show 'ns/def' -p '3,2,1'                          # 3. éªŒè¯ï¼ˆå¯é€‰ï¼‰
```

### ä¸‰ç§æœç´¢æ–¹å¼

```bash
cr query search 'target' -f 'ns/def'                      # æœç´¢ç¬¦å·/å­—ç¬¦ä¸²
cr query search-expr 'fn (x)' -f 'ns/def' -l              # æœç´¢ä»£ç ç»“æ„
cr tree replace-leaf 'ns/def' --pattern 'old' --replacement 'new'  # æ‰¹é‡æ›¿æ¢
```

### æ•ˆç‡å¯¹æ¯”

| æ“ä½œ       | ä¼ ç»Ÿæ–¹æ³•                | search æ–¹æ³•         | æ•ˆç‡     |
| ---------- | ----------------------- | ------------------- | -------- |
| å®šä½ç¬¦å·   | é€å±‚ `tree show` 10+ æ­¥ | `query search` 1 æ­¥ | **10å€** |
| æŸ¥æ‰¾è¡¨è¾¾å¼ | æ‰‹åŠ¨éå†ä»£ç             | `search-expr` 1 æ­¥  | **10å€** |
| æ‰¹é‡é‡å‘½å | æ‰‹åŠ¨æ‰¾æ¯å¤„              | è‡ªåŠ¨åˆ—å‡ºæ‰€æœ‰ä½ç½®    | **5å€**  |

---

## âš ï¸ é‡è¦è­¦å‘Šï¼šç¦æ­¢ç›´æ¥ä¿®æ”¹çš„æ–‡ä»¶

ä»¥ä¸‹æ–‡ä»¶**ä¸¥æ ¼ç¦æ­¢ä½¿ç”¨æ–‡æœ¬æ›¿æ¢æˆ–ç›´æ¥ç¼–è¾‘**ï¼š

- **`calcit.cirru`** - è¿™æ˜¯ calcit-editor ç»“æ„åŒ–ç¼–è¾‘å™¨çš„ä¸“ç”¨æ ¼å¼ï¼ŒåŒ…å«å®Œæ•´çš„ç¼–è¾‘å™¨å…ƒæ•°æ®
- **`compact.cirru`** - è¿™æ˜¯ Calcit ç¨‹åºçš„ç´§å‡‘å¿«ç…§æ ¼å¼ï¼Œå¿…é¡»ä½¿ç”¨ `cr edit` ç›¸å…³å‘½ä»¤è¿›è¡Œä¿®æ”¹

è¿™ä¸¤ä¸ªæ–‡ä»¶çš„æ ¼å¼å¯¹ç©ºæ ¼å’Œç»“æ„æå…¶æ•æ„Ÿï¼Œç›´æ¥æ–‡æœ¬ä¿®æ”¹ä¼šç ´åæ–‡ä»¶ç»“æ„ã€‚è¯·ä½¿ç”¨ä¸‹é¢æ–‡æ¡£ä¸­çš„ CLI å‘½ä»¤è¿›è¡Œä»£ç æŸ¥è¯¢å’Œä¿®æ”¹ã€‚

## Calcit ä¸ Cirru çš„å…³ç³»

- **Calcit** æ˜¯ç¼–ç¨‹è¯­è¨€æœ¬èº«ï¼ˆä¸€é—¨ç±»ä¼¼ Clojure çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼‰
- **Cirru** æ˜¯è¯­æ³•æ ¼å¼ï¼ˆç¼©è¿›é£æ ¼çš„ S-expressionï¼Œç±»ä¼¼å»æ‰æ‹¬å·æ”¹ç”¨ç¼©è¿›çš„ Lispï¼‰
- **å…³ç³»**ï¼šCalcit ä»£ç ä½¿ç”¨ Cirru è¯­æ³•ä¹¦å†™å’Œå­˜å‚¨

**å…·ä½“ä½“ç°ï¼š**

- `compact.cirru` å’Œ `calcit.cirru` æ˜¯ç”¨ Cirru æ ¼å¼å­˜å‚¨çš„ Calcit ç¨‹åº
- `cr cirru` å·¥å…·ç”¨äº Cirru è¯­æ³•ä¸ JSON çš„è½¬æ¢ï¼ˆå¸®åŠ©ç†è§£å’Œç”Ÿæˆä»£ç ï¼‰
- Cirru è¯­æ³•ç‰¹ç‚¹ï¼š
  - ç”¨ç¼©è¿›ä»£æ›¿æ‹¬å·ï¼ˆç±»ä¼¼ Python/YAMLï¼‰
  - å­—ç¬¦ä¸²ç”¨å‰ç¼€ `|` æˆ– `"` æ ‡è®°ï¼ˆå¦‚ `|hello` è¡¨ç¤ºå­—ç¬¦ä¸² "hello"ï¼‰
  - å•è¡Œç”¨ç©ºæ ¼åˆ†éš”å…ƒç´ ï¼ˆå¦‚ `defn add (a b) (+ a b)`ï¼‰

**ç±»æ¯”ç†è§£ï¼š**

- Python è¯­è¨€ â† ä½¿ç”¨ â†’ Python è¯­æ³•
- Calcit è¯­è¨€ â† ä½¿ç”¨ â†’ Cirru è¯­æ³•

ç”Ÿæˆ Calcit ä»£ç å‰ï¼Œå»ºè®®å…ˆè¿è¡Œ `cr cirru show-guide` äº†è§£ Cirru è¯­æ³•è§„åˆ™ã€‚

---

## Calcit CLI å‘½ä»¤

Calcit ç¨‹åºä½¿ç”¨ `cr` å‘½ä»¤ï¼š

### ä¸»è¦è¿è¡Œå‘½ä»¤

- `cr` æˆ– `cr compact.cirru` - ä»£ç è§£é‡Šæ‰§è¡Œï¼Œé»˜è®¤è¯»å– config æ‰§è¡Œ init-fn å®šä¹‰çš„å…¥å£
- `cr compact.cirru js` - ç¼–è¯‘ç”Ÿæˆ JavaScript ä»£ç 
- `cr -1 <filepath>` - æ‰§è¡Œä¸€æ¬¡ç„¶åé€€å‡ºï¼ˆä¸è¿›å…¥ç›‘å¬æ¨¡å¼ï¼‰
- `cr --check-only` - ä»…æ£€æŸ¥ä»£ç æ­£ç¡®æ€§ï¼Œä¸æ‰§è¡Œç¨‹åº
  - å¯¹ init_fn å’Œ reload_fn è¿›è¡Œé¢„å¤„ç†éªŒè¯
  - è¾“å‡ºï¼šé¢„å¤„ç†è¿›åº¦ã€warningsã€æ£€æŸ¥è€—æ—¶
  - ç”¨äº CI/CD æˆ–å¿«é€ŸéªŒè¯ä»£ç ä¿®æ”¹
- `cr js -1` - æ£€æŸ¥ä»£ç æ­£ç¡®æ€§ï¼Œç”Ÿæˆ JavaScript(ä¸è¿›å…¥ç›‘å¬æ¨¡å¼)
- `cr js --check-only` - æ£€æŸ¥ä»£ç æ­£ç¡®æ€§ï¼Œä¸ç”Ÿæˆ JavaScript
- `cr eval '<code>' [--dep <module>...]` - æ‰§è¡Œä¸€æ®µ Calcit ä»£ç ç‰‡æ®µï¼Œç”¨äºå¿«é€ŸéªŒè¯å†™æ³•
  - `--dep` å‚æ•°å¯ä»¥åŠ è½½ `~/.config/calcit/modules/` ä¸­çš„æ¨¡å—ï¼ˆç›´æ¥ä½¿ç”¨æ¨¡å—åï¼‰
  - ç¤ºä¾‹ï¼š`cr eval 'echo 1' --dep calcit.std`
  - å¯å¤šæ¬¡ä½¿ç”¨ `--dep` åŠ è½½å¤šä¸ªæ¨¡å—

### æŸ¥è¯¢å­å‘½ä»¤ (`cr query`)

è¿™äº›å‘½ä»¤ç”¨äºæŸ¥è¯¢é¡¹ç›®ä¿¡æ¯ï¼š

**é¡¹ç›®å…¨å±€åˆ†æï¼š**

- `cr analyze call-graph` - åˆ†æä»å…¥å£ç‚¹å¼€å§‹çš„è°ƒç”¨å›¾ç»“æ„
- `cr analyze count-calls` - ç»Ÿè®¡æ¯ä¸ªå®šä¹‰çš„è°ƒç”¨æ¬¡æ•°

  _ä½¿ç”¨ç¤ºä¾‹ï¼š_

  ```bash
  # åˆ†ææ•´ä¸ªé¡¹ç›®çš„è°ƒç”¨å›¾
  cr analyze call-graph
  # ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°
  cr analyze count-calls
  ```

**åŸºç¡€æŸ¥è¯¢ï¼š**

- `cr query ns [--deps]` - åˆ—å‡ºé¡¹ç›®ä¸­æ‰€æœ‰å‘½åç©ºé—´ï¼ˆ--deps åŒ…å«ä¾èµ–ï¼‰
- `cr query ns <namespace>` - è¯»å–å‘½åç©ºé—´è¯¦æƒ…ï¼ˆimports, å®šä¹‰é¢„è§ˆï¼‰
- `cr query defs <namespace>` - åˆ—å‡ºå‘½åç©ºé—´ä¸­çš„å®šä¹‰
- `cr query pkg` - è·å–é¡¹ç›®åŒ…å
- `cr query config` - è¯»å–é¡¹ç›®é…ç½®ï¼ˆinit_fn, reload_fn, versionï¼‰
- `cr query error` - è¯»å– .calcit-error.cirru é”™è¯¯å †æ ˆæ–‡ä»¶
- `cr query modules` - åˆ—å‡ºé¡¹ç›®ä¾èµ–çš„æ¨¡å—ï¼ˆæ¥è‡ª compact.cirru é…ç½®ï¼‰

**æ¸è¿›å¼ä»£ç æ¢ç´¢ï¼ˆProgressive Disclosureï¼‰ï¼š**

- `cr query peek <namespace/definition>` - æŸ¥çœ‹å®šä¹‰ç­¾åï¼ˆå‚æ•°ã€æ–‡æ¡£ã€è¡¨è¾¾å¼æ•°é‡ï¼‰ï¼Œä¸è¿”å›å®Œæ•´å®ç°ä½“
  - è¾“å‡ºï¼šDocã€Form ç±»å‹ã€å‚æ•°åˆ—è¡¨ã€Body è¡¨è¾¾å¼æ•°é‡ã€é¦–ä¸ªè¡¨è¾¾å¼é¢„è§ˆã€Examples æ•°é‡
  - ç”¨äºå¿«é€Ÿäº†è§£å‡½æ•°æ¥å£ï¼Œå‡å°‘ token æ¶ˆè€—
- `cr query def <namespace/definition> [-j]` - è¯»å–å®šä¹‰çš„å®Œæ•´ Cirru ä»£ç 
  - é»˜è®¤è¾“å‡ºï¼šDocã€Examples æ•°é‡ã€Cirru æ ¼å¼ä»£ç 
  - `-j` / `--json`ï¼šåŒæ—¶è¾“å‡º JSON æ ¼å¼ï¼ˆç”¨äºç¨‹åºåŒ–å¤„ç†ï¼‰
  - æ¨èï¼šLLM ç›´æ¥è¯»å– Cirru æ ¼å¼å³å¯ï¼Œé€šå¸¸ä¸éœ€è¦ JSON
- `cr query examples <namespace/definition>` - è¯»å–å®šä¹‰çš„ç¤ºä¾‹ä»£ç 
  - è¾“å‡ºï¼šæ¯ä¸ª example çš„ Cirru æ ¼å¼å’Œ JSON æ ¼å¼

**ç¬¦å·æœç´¢ä¸å¼•ç”¨åˆ†æï¼š**

- `cr query find <symbol> [--deps] [-f] [-n <limit>]` - è·¨å‘½åç©ºé—´æœç´¢ç¬¦å·
  - é»˜è®¤ç²¾ç¡®åŒ¹é…ï¼šè¿”å›å®šä¹‰ä½ç½® + æ‰€æœ‰å¼•ç”¨ä½ç½®ï¼ˆå¸¦ä¸Šä¸‹æ–‡é¢„è§ˆï¼‰
  - `-f` / `--fuzzy`ï¼šæ¨¡ç³Šæœç´¢ï¼ŒåŒ¹é… "namespace/definition" æ ¼å¼çš„è·¯å¾„
  - `-n <limit>`ï¼šé™åˆ¶æ¨¡ç³Šæœç´¢ç»“æœæ•°é‡ï¼ˆé»˜è®¤ 20ï¼‰
  - `--deps`ï¼šåŒ…å«æ ¸å¿ƒå‘½åç©ºé—´ï¼ˆcalcit.\* å¼€å¤´ï¼‰
- `cr query usages <namespace/definition> [--deps]` - æŸ¥æ‰¾å®šä¹‰çš„æ‰€æœ‰ä½¿ç”¨ä½ç½®
  - è¿”å›ï¼šå¼•ç”¨è¯¥å®šä¹‰çš„æ‰€æœ‰ä½ç½®ï¼ˆå¸¦ä¸Šä¸‹æ–‡é¢„è§ˆï¼‰
  - ç”¨äºç†è§£ä»£ç å½±å“èŒƒå›´ï¼Œé‡æ„å‰çš„å½±å“åˆ†æ

**ä»£ç æ¨¡å¼æœç´¢ï¼ˆå¿«é€Ÿå®šä½ â­â­â­ï¼‰ï¼š**

- `cr query search <pattern> [-f <filter>] [-l]` - æœç´¢å¶å­èŠ‚ç‚¹ï¼ˆç¬¦å·/å­—ç¬¦ä¸²ï¼‰ï¼Œæ¯”é€å±‚å¯¼èˆªå¿« 10 å€
  - `-f <filter>` - è¿‡æ»¤åˆ°ç‰¹å®šå‘½åç©ºé—´æˆ–å®šä¹‰
  - `-l / --loose`ï¼šå®½æ¾åŒ¹é…ï¼ŒåŒ…å«æ¨¡å¼
  - `-d <max-depth>`ï¼šé™åˆ¶æœç´¢æ·±åº¦
  - `-p <start-path>`ï¼šä»æŒ‡å®šè·¯å¾„å¼€å§‹æœç´¢ï¼ˆå¦‚ `"3,2,1"`ï¼‰
  - è¿”å›ï¼šå®Œæ•´è·¯å¾„ + çˆ¶çº§ä¸Šä¸‹æ–‡ï¼Œå¤šä¸ªåŒ¹é…æ—¶è‡ªåŠ¨æ˜¾ç¤ºæ‰¹é‡æ›¿æ¢å‘½ä»¤
  - ç¤ºä¾‹ï¼š
    - `cr query search 'println' -f app.main/main!` - ç²¾ç¡®æœç´¢
    - `cr query search 'comp-' -f app.ui/layout -l` - æ¨¡ç³Šæœç´¢ï¼ˆæ‰€æœ‰ comp- å¼€å¤´ï¼‰
    - `cr query search 'task-id' -f app.comp/render` - è¿”å›æ‰€æœ‰åŒ¹é…ä½ç½®å¹¶è‡ªåŠ¨æ’åº

**é«˜çº§ç»“æ„æœç´¢ï¼ˆæœç´¢ä»£ç ç»“æ„ â­â­â­ï¼‰ï¼š**

- `cr query search-expr <pattern> [-f <filter>] [-l] [-j]` - æœç´¢ç»“æ„è¡¨è¾¾å¼ï¼ˆListï¼‰
  - `-l / --loose`ï¼šå®½æ¾åŒ¹é…ï¼ŒæŸ¥æ‰¾åŒ…å«è¿ç»­å­åºåˆ—çš„ç»“æ„
  - `-j / --json`ï¼šå°†æ¨¡å¼è§£æä¸º JSON æ•°ç»„
  - ç¤ºä¾‹ï¼š
    - `cr query search-expr 'fn (x)' -f app.main/process -l` - æŸ¥æ‰¾å‡½æ•°å®šä¹‰
    - `cr query search-expr '>> state task-id'` - æŸ¥æ‰¾çŠ¶æ€è®¿é—®
    - `cr query search-expr 'memof1-call-by' -l` - æŸ¥æ‰¾è®°å¿†åŒ–è°ƒç”¨

**æœç´¢ç»“æœæ ¼å¼ï¼š** `[ç´¢å¼•1,ç´¢å¼•2,...] in çˆ¶çº§ä¸Šä¸‹æ–‡`ï¼Œå¯é…åˆ `cr tree show <ns/def> -p '<path>'` æŸ¥çœ‹èŠ‚ç‚¹ã€‚**ä¿®æ”¹ä»£ç æ—¶ä¼˜å…ˆç”¨ search å‘½ä»¤ï¼Œæ¯”é€å±‚å¯¼èˆªå¿« 10 å€ã€‚**

### LLM è¾…åŠ©ï¼šåŠ¨æ€æ–¹æ³•æç¤º

- `&inspect-class-methods` - æ‰“å°æŸä¸ªå€¼å¯¹åº” class çš„æ–¹æ³•æ¸…å•ï¼ˆä¸æ”¹å˜åŸå€¼ï¼‰
  - ç”¨æ³•ï¼š`(&inspect-class-methods value |optional note)`
  - ç”¨é€”ï¼šå¸®åŠ© LLM å‘ç°åŠ¨æ€ç±»å‹çš„æ–¹æ³•ä¸ proc ç­¾åä¿¡æ¯ï¼ˆä¸æ˜¯æµ‹è¯•/éªŒè¯ç”¨é€”ï¼‰
  - é€‚åˆåœ¨ pipeline ä¸­æ’å…¥ï¼Œå¿«é€ŸæŸ¥çœ‹æ–¹æ³•ã€å‚æ•°ã€å‘½åç©ºé—´å’Œ proc ç±»å‹ä¿¡æ¯

### æ–‡æ¡£å­å‘½ä»¤ (`cr docs`)

æŸ¥è¯¢ Calcit è¯­è¨€æ–‡æ¡£ï¼ˆguidebookï¼‰ï¼š

- `cr docs search <keyword> [-c <num>] [-f <filename>]` - æŒ‰å…³é”®è¯æœç´¢æ–‡æ¡£å†…å®¹
  - `-c <num>` - æ˜¾ç¤ºåŒ¹é…è¡Œçš„ä¸Šä¸‹æ–‡è¡Œæ•°ï¼ˆé»˜è®¤ 5ï¼‰
  - `-f <filename>` - æŒ‰æ–‡ä»¶åè¿‡æ»¤æœç´¢ç»“æœ
  - è¾“å‡ºï¼šåŒ¹é…è¡ŒåŠå…¶ä¸Šä¸‹æ–‡ï¼Œå¸¦è¡Œå·å’Œé«˜äº®
  - ç¤ºä¾‹ï¼š`cr docs search "macro" -c 10` æˆ– `cr docs search "defn" -f macros.md`

- `cr docs read <filename> [-s <start>] [-n <lines>]` - é˜…è¯»æŒ‡å®šæ–‡æ¡£
  - `-s <start>` - èµ·å§‹è¡Œå·ï¼ˆé»˜è®¤ 0ï¼‰
  - `-n <lines>` - è¯»å–è¡Œæ•°ï¼ˆé»˜è®¤ 80ï¼‰
  - è¾“å‡ºï¼šæ–‡æ¡£å†…å®¹ã€å½“å‰èŒƒå›´ã€æ˜¯å¦æœ‰æ›´å¤šå†…å®¹
  - ç¤ºä¾‹ï¼š`cr docs read macros.md` æˆ– `cr docs read intro.md -s 20 -n 30`

- `cr docs list` - åˆ—å‡ºæ‰€æœ‰å¯ç”¨æ–‡æ¡£

### Cirru è¯­æ³•å·¥å…· (`cr cirru`)

ç”¨äº Cirru è¯­æ³•å’Œ JSON ä¹‹é—´çš„è½¬æ¢ï¼š

- `cr cirru parse '<cirru_code>'` - è§£æ Cirru ä»£ç ä¸º JSON
- `cr cirru format '<json>'` - æ ¼å¼åŒ– JSON ä¸º Cirru ä»£ç 
- `cr cirru parse-edn '<edn>'` - è§£æ Cirru EDN ä¸º JSON
- `cr cirru show-guide` - æ˜¾ç¤º Cirru è¯­æ³•æŒ‡å—ï¼ˆå¸®åŠ© LLM ç”Ÿæˆæ­£ç¡®çš„ Cirru ä»£ç ï¼‰

**âš ï¸ é‡è¦ï¼šç”Ÿæˆ Cirru ä»£ç å‰è¯·å…ˆé˜…è¯»è¯­æ³•æŒ‡å—**

è¿è¡Œ `cr cirru show-guide` è·å–å®Œæ•´çš„ Cirru è¯­æ³•è¯´æ˜ï¼ŒåŒ…æ‹¬ï¼š

- `$` æ“ä½œç¬¦ï¼ˆå•èŠ‚ç‚¹å±•å¼€ï¼‰
- `|` å‰ç¼€ï¼ˆå­—ç¬¦ä¸²å­—é¢é‡ï¼‰, è¿™ä¸ªæ˜¯ Cirru ç‰¹æ®Šçš„åœ°æ–¹, è€Œä¸æ˜¯ç›´æ¥ç”¨å¼•å·åŒ…è£¹
- `,` æ“ä½œç¬¦ï¼ˆæ³¨é‡Šæ ‡è®°ï¼‰
- `~` å’Œ `~@`ï¼ˆå®å±•å¼€ï¼‰
- å¸¸è§é”™è¯¯å’Œé¿å…æ–¹æ³•

### åº“ç®¡ç† (`cr libs`)

æŸ¥è¯¢å’Œäº†è§£ Calcit å®˜æ–¹åº“ï¼š

- `cr libs` - åˆ—å‡ºæ‰€æœ‰å®˜æ–¹åº“
- `cr libs search <keyword>` - æŒ‰å…³é”®è¯æœç´¢åº“ï¼ˆæœç´¢åç§°ã€æè¿°ã€åˆ†ç±»ï¼‰
- `cr libs readme <package> [-f <file>]` - æŸ¥çœ‹åº“çš„æ–‡æ¡£
  - ä¼˜å…ˆä»æœ¬åœ° `~/.config/calcit/modules/<package>` è¯»å–
  - æœ¬åœ°ä¸å­˜åœ¨æ—¶ä» GitHub ä»“åº“è·å–
  - `-f` å‚æ•°å¯æŒ‡å®šå…¶ä»–æ–‡æ¡£æ–‡ä»¶ï¼ˆå¦‚ `-f Skills.md`ï¼‰
  - é»˜è®¤è¯»å– `README.md`
- `cr libs scan-md <module>` - æ‰«ææœ¬åœ°æ¨¡å—ç›®å½•ä¸‹çš„æ‰€æœ‰ `.md` æ–‡ä»¶
  - é€’å½’æ‰«æå­ç›®å½•
  - æ˜¾ç¤ºç›¸å¯¹è·¯å¾„åˆ—è¡¨
- `caps` - å®‰è£…/æ›´æ–°ä¾èµ–

**æŸ¥çœ‹å·²å®‰è£…æ¨¡å—ï¼š**

```bash
# åˆ—å‡º ~/.config/calcit/modules/ ä¸‹æ‰€æœ‰å·²å®‰è£…çš„æ¨¡å—
ls ~/.config/calcit/modules/

# æŸ¥çœ‹å½“å‰é¡¹ç›®é…ç½®çš„æ¨¡å—ä¾èµ–
cr query modules
```

### ç²¾ç»†ä»£ç æ ‘æ“ä½œ (`cr tree`)

âš ï¸ **å…³é”®è­¦å‘Šï¼šè·¯å¾„ç´¢å¼•åŠ¨æ€å˜åŒ–**

åˆ é™¤æˆ–æ’å…¥èŠ‚ç‚¹åï¼ŒåŒçº§åç»­èŠ‚ç‚¹çš„ç´¢å¼•ä¼šè‡ªåŠ¨æ”¹å˜ã€‚**å¿…é¡»ä»åå¾€å‰æ“ä½œ**æˆ–**æ¯æ¬¡ä¿®æ”¹åé‡æ–°æœç´¢è·¯å¾„**ã€‚

**æ ¸å¿ƒæ¦‚å¿µï¼š**

- è·¯å¾„æ ¼å¼ï¼šé€—å·åˆ†éš”çš„ç´¢å¼•ï¼ˆå¦‚ `"3,2,1"`ï¼‰ï¼Œç©ºå­—ç¬¦ä¸² `""` è¡¨ç¤ºæ ¹èŠ‚ç‚¹
- æ¯ä¸ªå‘½ä»¤éƒ½æœ‰ `--help` æŸ¥çœ‹è¯¦ç»†å‚æ•°
- å‘½ä»¤æ‰§è¡Œåä¼šæ˜¾ç¤º "Next steps" æç¤ºä¸‹ä¸€æ­¥æ“ä½œ

**ä¸»è¦æ“ä½œï¼š**

- `cr tree show <ns/def> -p '<path>' [-j]` - æŸ¥çœ‹èŠ‚ç‚¹
  - é»˜è®¤è¾“å‡ºï¼šèŠ‚ç‚¹ç±»å‹ã€Cirru é¢„è§ˆã€å­èŠ‚ç‚¹ç´¢å¼•åˆ—è¡¨ã€æ“ä½œæç¤º
  - `-j` / `--json`ï¼šåŒæ—¶è¾“å‡º JSON æ ¼å¼ï¼ˆç”¨äºç¨‹åºåŒ–å¤„ç†ï¼‰
  - æ¨èï¼šç›´æ¥æŸ¥çœ‹ Cirru æ ¼å¼å³å¯ï¼Œé€šå¸¸ä¸éœ€è¦ JSON
- `cr tree replace` - æ›¿æ¢èŠ‚ç‚¹
- `cr tree replace-leaf` - æŸ¥æ‰¾å¹¶æ›¿æ¢æ‰€æœ‰åŒ¹é…çš„ leaf èŠ‚ç‚¹ï¼ˆæ— éœ€æŒ‡å®šè·¯å¾„ï¼‰
  - `--pattern <pattern>` - è¦æœç´¢çš„æ¨¡å¼ï¼ˆç²¾ç¡®åŒ¹é… leaf èŠ‚ç‚¹ï¼‰
  - `--replacement <value>` - æ›¿æ¢å€¼ï¼ˆé»˜è®¤ä½œä¸º leaf èŠ‚ç‚¹å¤„ç†ï¼‰
  - è‡ªåŠ¨éå†æ•´ä¸ªå®šä¹‰ï¼Œä¸€æ¬¡æ€§æ›¿æ¢æ‰€æœ‰åŒ¹é…é¡¹
  - ç¤ºä¾‹ï¼š`cr tree replace-leaf 'ns/def' --pattern 'old-name' --replacement 'new-name'`
- `cr tree delete` - åˆ é™¤èŠ‚ç‚¹
- `cr tree insert-before/after` - æ’å…¥ç›¸é‚»èŠ‚ç‚¹
- `cr tree insert-child/append-child` - æ’å…¥å­èŠ‚ç‚¹
- `cr tree swap-next/prev` - äº¤æ¢ç›¸é‚»èŠ‚ç‚¹
- `cr tree wrap` - ç”¨æ–°ç»“æ„åŒ…è£…èŠ‚ç‚¹

**è¾“å…¥æ–¹å¼ï¼ˆé€šç”¨ï¼‰ï¼š**

- `-e '<code>'` - å†…è”ä»£ç ï¼ˆè‡ªåŠ¨è¯†åˆ« Cirru/JSONï¼‰
- `--leaf` - å¼ºåˆ¶ä½œä¸º leaf èŠ‚ç‚¹ï¼ˆç¬¦å·æˆ–å­—ç¬¦ä¸²ï¼‰
- `-j '<json>'` / `-f <file>` / `-s` (stdin)

**æ¨èå·¥ä½œæµï¼ˆé«˜æ•ˆå®šä½ â­â­â­ï¼‰ï¼š**

```bash
# ===== æ–¹æ¡ˆ Aï¼šå•ç‚¹ä¿®æ”¹ï¼ˆç²¾ç¡®å®šä½ï¼‰ =====

# 1. å¿«é€Ÿå®šä½ç›®æ ‡èŠ‚ç‚¹ï¼ˆä¸€æ­¥åˆ°ä½ï¼‰
cr query search "target-symbol" -f namespace/def
# è¾“å‡ºï¼š[3,2,5,1] in (fn (x) target-symbol ...)

# 2. ç›´æ¥ä¿®æ”¹ï¼ˆè·¯å¾„å·²çŸ¥ï¼‰
cr tree replace namespace/def -p '3,2,5,1' --leaf -e 'new-symbol'

# 3. éªŒè¯ç»“æœï¼ˆå¯é€‰ï¼‰
cr tree show namespace/def -p '3,2,5,1'


# ===== æ–¹æ¡ˆ Bï¼šæ‰¹é‡é‡å‘½åï¼ˆå¤šå¤„ä¿®æ”¹ï¼‰ =====

# 1. æœç´¢æ‰€æœ‰åŒ¹é…ä½ç½®
cr query search "old-name" -f namespace/def
# è‡ªåŠ¨æ˜¾ç¤ºï¼š4 å¤„åŒ¹é…ï¼Œå·²æŒ‰è·¯å¾„ä»å¤§åˆ°å°æ’åº
# [3,2,5,8] [3,2,5,2] [3,1,0] [2,1]

# 2. æŒ‰æç¤ºä»åå¾€å‰ä¿®æ”¹ï¼ˆé¿å…è·¯å¾„å˜åŒ–ï¼‰
cr tree replace namespace/def -p '3,2,5,8' --leaf -e 'new-name'
cr tree replace namespace/def -p '3,2,5,2' --leaf -e 'new-name'
# ... ç»§ç»­æŒ‰åºä¿®æ”¹

# æˆ–ï¼šä¸€æ¬¡æ€§æ›¿æ¢æ‰€æœ‰åŒ¹é…é¡¹
cr tree replace-leaf namespace/def --pattern 'old-name' --replacement 'new-name'


# ===== æ–¹æ¡ˆ Cï¼šç»“æ„æœç´¢ï¼ˆæŸ¥æ‰¾è¡¨è¾¾å¼ï¼‰ =====

# 1. æœç´¢åŒ…å«ç‰¹å®šæ¨¡å¼çš„è¡¨è¾¾å¼
cr query search-expr "fn (task)" -f namespace/def -l
# è¾“å‡ºï¼š[3,2,2,5,2,4,1] in (map $ fn (task) ...)

# 2. æŸ¥çœ‹å®Œæ•´ç»“æ„ï¼ˆå¯é€‰ï¼‰
cr tree show namespace/def -p '3,2,2,5,2,4,1'

# 3. ä¿®æ”¹æ•´ä¸ªè¡¨è¾¾å¼æˆ–å­èŠ‚ç‚¹
cr tree replace namespace/def -p '3,2,2,5,2,4,1,2' -e 'let ((x 1)) (+ x task)'
```

**å…³é”®æŠ€å·§ï¼š**

- **ä¼˜å…ˆä½¿ç”¨ `search` ç³»åˆ—å‘½ä»¤**ï¼šæ¯”é€å±‚å¯¼èˆªå¿« 10+ å€ï¼Œä¸€æ­¥ç›´è¾¾ç›®æ ‡
- **è·¯å¾„æ ¼å¼**ï¼š`"3,2,1"` è¡¨ç¤ºç¬¬3ä¸ªå­èŠ‚ç‚¹ â†’ ç¬¬2ä¸ªå­èŠ‚ç‚¹ â†’ ç¬¬1ä¸ªå­èŠ‚ç‚¹
- **æ‰¹é‡ä¿®æ”¹è‡ªåŠ¨æç¤º**ï¼šæœç´¢æ‰¾åˆ°å¤šå¤„æ—¶ï¼Œè‡ªåŠ¨æ˜¾ç¤ºè·¯å¾„æ’åºå’Œæ‰¹é‡æ›¿æ¢å‘½ä»¤
- **è·¯å¾„åŠ¨æ€å˜åŒ–**ï¼šåˆ é™¤/æ’å…¥åï¼ŒåŒçº§åç»­ç´¢å¼•ä¼šå˜åŒ–ï¼ŒæŒ‰æç¤ºä»åå¾€å‰æ“ä½œ
- æ‰€æœ‰å‘½ä»¤éƒ½ä¼šæ˜¾ç¤º Next steps å’Œæ“ä½œæç¤º

**ç»“æ„åŒ–å˜æ›´ç¤ºä¾‹ï¼š**

è¿™äº›é«˜çº§æ“ä½œå…è®¸ä½ åœ¨ä¿®æ”¹æ—¶å¼•ç”¨åŸå§‹èŠ‚ç‚¹åŠå…¶å†…éƒ¨ç»“æ„ï¼š

- **åŒ…è£¹èŠ‚ç‚¹**ï¼ˆä½¿ç”¨ `cr tree wrap` æˆ– `cr tree replace` çš„ `--refer-original`ï¼‰ï¼š

  ```bash
  # å°†è·¯å¾„ "3,2" çš„èŠ‚ç‚¹åŒ…è£¹åœ¨ println ä¸­
  cr tree wrap ns/def -p '3,2' -e 'println $$$$' --refer-original '$$$$'
  ```

- **é‡æ„å¹¶å¤ç”¨åŸå­èŠ‚ç‚¹**ï¼ˆä½¿ç”¨ `--refer-inner-branch`ï¼‰ï¼š
  - å‡è®¾åŸèŠ‚ç‚¹æ˜¯ `(+ 1 2)` (è·¯å¾„ "3,1")ï¼Œå…¶å­èŠ‚ç‚¹ç´¢å¼• 1 æ˜¯ `1`ï¼Œç´¢å¼• 2 æ˜¯ `2`
  - å°†å…¶é‡æ„ä¸º `(* 2 10)`ï¼š

  ```bash
  cr tree replace ns/def -p '3,1' -e '(* #### 10)' --refer-inner-branch '2' --refer-inner-placeholder '####'
  ```

- **å¤šå¤„é‡ç”¨åŸå§‹èŠ‚ç‚¹**ï¼š
  ```bash
  # å°†èŠ‚ç‚¹ x å˜ä¸º (+ x x)
  cr tree replace ns/def -p '2' -e '(+ $ $)' --refer-original '$'
  ```
  è¯¦ç»†å‚æ•°å’Œç¤ºä¾‹ä½¿ç”¨ `cr tree <command> --help` æŸ¥çœ‹ã€‚

### ä»£ç ç¼–è¾‘ (`cr edit`)

ç›´æ¥ç¼–è¾‘ compact.cirru é¡¹ç›®ä»£ç ï¼Œæ”¯æŒä¸‰ç§è¾“å…¥æ–¹å¼ï¼š

- `--file <path>` æˆ– `-f <path>` - ä»æ–‡ä»¶è¯»å–ï¼ˆé»˜è®¤ Cirru æ ¼å¼ï¼Œä½¿ç”¨ `-J` æŒ‡å®š JSONï¼‰
- `--json <string>` æˆ– `-j <string>` - å†…è” JSON å­—ç¬¦ä¸²
- `--stdin` æˆ– `-s` - ä»æ ‡å‡†è¾“å…¥è¯»å–ï¼ˆé»˜è®¤ Cirru æ ¼å¼ï¼Œä½¿ç”¨ `-J` æŒ‡å®š JSONï¼‰

é¢å¤–æ”¯æŒâ€œå†…è”ä»£ç â€å‚æ•°ï¼š

- `--code <text>` æˆ– `-e <text>`ï¼šç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œä¼ å…¥ä¸€æ®µä»£ç ã€‚
  - é»˜è®¤æŒ‰ **Cirru å•è¡Œè¡¨è¾¾å¼ï¼ˆone-linerï¼‰** è§£æã€‚
  - å¦‚æœè¾“å…¥â€œçœ‹èµ·æ¥åƒ JSONâ€ï¼ˆä¾‹å¦‚ `-e '"abc"'`ï¼Œæˆ– `-e '["a"]'` è¿™ç±» `[...]` ä¸”åŒ…å« `"`ï¼‰ï¼Œåˆ™ä¼šæŒ‰ JSON è§£æã€‚
  - âš ï¸ å½“è¾“å…¥çœ‹èµ·æ¥åƒ JSON ä½† JSON ä¸åˆæ³•æ—¶ï¼Œä¼šç›´æ¥æŠ¥é”™ï¼ˆä¸ä¼šå›é€€å½“æˆ Cirru one-linerï¼‰ã€‚

å¯¹ `--file/--stdin` è¾“å…¥ï¼Œè¿˜æ”¯æŒä»¥ä¸‹â€œæ ¼å¼å¼€å…³â€ï¼ˆä¸ `-J/--json-input` ç±»ä¼¼ï¼‰ï¼š

- `--leaf`ï¼šæŠŠè¾“å…¥å½“æˆ **leaf èŠ‚ç‚¹**ï¼Œç›´æ¥ä½¿ç”¨ Cirru ç¬¦å·æˆ– `|text` å­—ç¬¦ä¸²ï¼Œæ— éœ€ JSON å¼•å·ã€‚
  - ä¼ å…¥ç¬¦å·ï¼š`-e 'my-symbol'`
  - ä¼ å…¥å­—ç¬¦ä¸²ï¼šåŠ  Cirru å­—ç¬¦ä¸²å‰ç¼€ `|` æˆ– `"`ï¼Œä¾‹å¦‚ `-e '|my string'` æˆ– `-e '"my string'`

âš ï¸ æ³¨æ„ï¼šè¿™äº›å¼€å…³å½¼æ­¤äº’æ–¥ï¼ˆä¸€æ¬¡åªç”¨ä¸€ä¸ªï¼‰ã€‚

**æ¨èç®€åŒ–è§„åˆ™ï¼ˆå‘½ä»¤è¡Œæ›´å¥½å†™ï¼‰ï¼š**

- **JSONï¼ˆå•è¡Œï¼‰**ï¼šä¼˜å…ˆç”¨ `-j '<json>'` æˆ– `-e '<json>'`ï¼ˆä¸éœ€è¦ `-J`ï¼‰ã€‚
- **Cirru å•è¡Œè¡¨è¾¾å¼**ï¼šç”¨ `-e '<expr>'`ï¼ˆ`-e` é»˜è®¤æŒ‰ one-liner è§£æï¼‰ã€‚
- **Cirru å¤šè¡Œç¼©è¿›**ï¼šç”¨ `-f file.cirru` æˆ– `-s`ï¼ˆstdinï¼‰ã€‚
- `-J/--json-input` ä¸»è¦ç”¨äº **file/stdin** è¯»å…¥ JSONï¼ˆå¦‚ `-f code.json -J` æˆ– `-s -J`ï¼‰ã€‚

è¡¥å……ï¼š`-e/--code` åªæœ‰åœ¨ `[...]` å†…éƒ¨åŒ…å« `"` æ—¶æ‰ä¼šè‡ªåŠ¨æŒ‰ JSON è§£æï¼ˆä¾‹å¦‚ `-e '["a"]'`ï¼‰ã€‚
åƒ `-e '[]'` / `-e '[ ]'` ä¼šé»˜è®¤æŒ‰ Cirru one-liner å¤„ç†ï¼›å¦‚æœä½ éœ€è¦â€œç©º JSON æ•°ç»„â€ï¼Œç”¨æ˜¾å¼ JSONï¼š`-j '[]'`ã€‚

å¦‚æœä½ æƒ³åœ¨å‘½ä»¤è¡Œé‡Œæ˜ç¡®â€œè¿™æ®µå°±æ˜¯ JSONâ€ï¼Œè¯·ç”¨ `-j '<json>'`ï¼ˆ`-J` æ˜¯ç»™ file/stdin ç”¨çš„ï¼‰ã€‚

**å®šä¹‰æ“ä½œï¼š**

- `cr edit def <namespace/definition>` - æ·»åŠ æ–°å®šä¹‰ï¼ˆè‹¥å·²å­˜åœ¨ä¼šæŠ¥é”™ï¼Œéœ€ç”¨ `cr tree replace` ä¿®æ”¹ï¼‰
- `cr edit rm-def <namespace/definition>` - åˆ é™¤å®šä¹‰
- `cr edit doc <namespace/definition> '<doc>'` - æ›´æ–°å®šä¹‰çš„æ–‡æ¡£
- `cr edit examples <namespace/definition>` - è®¾ç½®å®šä¹‰çš„ç¤ºä¾‹ä»£ç ï¼ˆæ‰¹é‡æ›¿æ¢ï¼‰
- `cr edit add-example <namespace/definition>` - æ·»åŠ å•ä¸ªç¤ºä¾‹
- `cr edit rm-example <namespace/definition> <index>` - åˆ é™¤æŒ‡å®šç´¢å¼•çš„ç¤ºä¾‹ï¼ˆ0-basedï¼‰

**å‘½åç©ºé—´æ“ä½œï¼š**

- `cr edit add-ns <namespace>` - æ·»åŠ å‘½åç©ºé—´
- `cr edit rm-ns <namespace>` - åˆ é™¤å‘½åç©ºé—´
- `cr edit imports <namespace>` - æ›´æ–°å¯¼å…¥è§„åˆ™ï¼ˆå…¨é‡æ›¿æ¢ï¼‰
- `cr edit add-import <namespace>` - æ·»åŠ å•ä¸ª import è§„åˆ™
- `cr edit rm-import <namespace> <source_ns>` - ç§»é™¤æŒ‡å®šæ¥æºçš„ import è§„åˆ™
- `cr edit ns-doc <namespace> '<doc>'` - æ›´æ–°å‘½åç©ºé—´æ–‡æ¡£

**æ¨¡å—å’Œé…ç½®ï¼š**

- `cr edit add-module <module-path>` - æ·»åŠ æ¨¡å—ä¾èµ–
- `cr edit rm-module <module-path>` - åˆ é™¤æ¨¡å—ä¾èµ–
- `cr edit config <key> <value>` - è®¾ç½®é…ç½®ï¼ˆkey: init-fn, reload-fn, versionï¼‰

**å¢é‡å˜æ›´å¯¼å‡ºï¼š**

- `cr edit inc` - è®°å½•å¢é‡ä»£ç å˜æ›´å¹¶å¯¼å‡ºåˆ° `.compact-inc.cirru`ï¼Œè§¦å‘ watcher çƒ­æ›´æ–°
  - `--added <namespace/definition>` - æ ‡è®°æ–°å¢çš„å®šä¹‰
  - `--changed <namespace/definition>` - æ ‡è®°ä¿®æ”¹çš„å®šä¹‰
  - `--removed <namespace/definition>` - æ ‡è®°åˆ é™¤çš„å®šä¹‰
  - `--added-ns <namespace>` - æ ‡è®°æ–°å¢çš„å‘½åç©ºé—´
  - `--removed-ns <namespace>` - æ ‡è®°åˆ é™¤çš„å‘½åç©ºé—´
  - `--ns-updated <namespace>` - æ ‡è®°å‘½åç©ºé—´å¯¼å…¥å˜æ›´
  - é…åˆ watcher ä½¿ç”¨å®ç°çƒ­æ›´æ–°ï¼ˆè¯¦è§"å¼€å‘è°ƒè¯•"ç« èŠ‚ï¼‰

ä½¿ç”¨ `--help` å‚æ•°äº†è§£è¯¦ç»†çš„è¾“å…¥æ–¹å¼å’Œå‚æ•°é€‰é¡¹ã€‚

---

## Calcit è¯­è¨€åŸºç¡€

### Cirru è¯­æ³•æ ¸å¿ƒæ¦‚å¿µ

**ä¸å…¶ä»– Lisp çš„åŒºåˆ«ï¼š**

- **ç¼©è¿›è¯­æ³•**ï¼šç”¨ç¼©è¿›ä»£æ›¿æ‹¬å·ï¼ˆç±»ä¼¼ Python/YAMLï¼‰ï¼Œå•è¡Œç”¨ç©ºæ ¼åˆ†éš”
- **å­—ç¬¦ä¸²å‰ç¼€**ï¼š`|hello` æˆ– `"hello"` è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œ`|` å‰ç¼€æ›´ç®€æ´
- **æ— æ–¹æ‹¬å·èŠ±æ‹¬å·**ï¼šåªç”¨åœ†æ‹¬å·æ¦‚å¿µï¼ˆä½“ç°åœ¨ JSON è½¬æ¢ä¸­ï¼‰ï¼ŒCirru æ–‡æœ¬å±‚é¢æ— æ‹¬å·

**å¸¸è§æ··æ·†ç‚¹ï¼š**

âŒ **é”™è¯¯ç†è§£ï¼š** Calcit å­—ç¬¦ä¸²æ˜¯ `"x"` â†’ JSON æ˜¯ `"\"x\""`  
âœ… **æ­£ç¡®ç†è§£ï¼š** Cirru `|x` â†’ JSON `"x"`ï¼ŒCirru `"x"` â†’ JSON `"x"`

**å­—ç¬¦ä¸² vs ç¬¦å·çš„å…³é”®åŒºåˆ†ï¼š**

- `|Add` æˆ– `"Add` â†’ **å­—ç¬¦ä¸²**ï¼ˆç”¨äºæ˜¾ç¤ºæ–‡æœ¬ã€å±æ€§å€¼ç­‰, å‰ç¼€å½¢å¼åŒºåˆ†å­—é¢é‡ç±»å‹ï¼‰
- `Add` â†’ **ç¬¦å·/å˜é‡å**ï¼ˆCalcit ä¼šåœ¨ä½œç”¨åŸŸä¸­æŸ¥æ‰¾ï¼‰
- å¸¸è§é”™è¯¯ï¼šå—å…¶ä»–è¯­è¨€ä¹ æƒ¯å½±å“ï¼Œå¿˜è®°åŠ  `|` å‰ç¼€å¯¼è‡´ `unknown symbol` é”™è¯¯

**CLI ä½¿ç”¨æç¤ºï¼š**

- æ›¿æ¢åŒ…å«ç©ºæ ¼çš„å­—ç¬¦ä¸²ï¼š`--leaf -e '|text with spaces'` æˆ– `-j '"text"'`
- é¿å…è§£æä¸ºåˆ—è¡¨ï¼šå­—ç¬¦ä¸²å­—é¢é‡å¿…é¡»ç”¨ `--leaf` æˆ– `-j` æ˜ç¡®æ ‡è®°

**ç¤ºä¾‹å¯¹ç…§ï¼š**

| Cirru ä»£ç        | JSON ç­‰ä»·                        | JavaScript ç­‰ä»·          |
| ---------------- | -------------------------------- | ------------------------ |
| `\|hello`        | `"hello"`                        | `"hello"`                |
| `"world"`        | `"world"`                        | `"world"`                |
| `\|a b c`        | `"a b c"`                        | `"a b c"`                |
| `fn (x) (+ x 1)` | `["fn", ["x"], ["+", "x", "1"]]` | `fn(x) { return x + 1 }` |

### æ•°æ®ç»“æ„ï¼šTuple vs Vector

Calcit ç‰¹æœ‰çš„ä¸¤ç§åºåˆ—ç±»å‹ï¼š

**Tuple (`::`)** - ä¸å¯å˜ã€ç”¨äºæ¨¡å¼åŒ¹é…

```cirru
; åˆ›å»º tuple
:: :event/type data

; æ¨¡å¼åŒ¹é…
tag-match event
  (:event/click data) (handle-click data)
  (:event/input text) (handle-input text)
```

**Vector (`[]`)** - å¯å˜ã€ç”¨äºåˆ—è¡¨æ“ä½œ

```cirru
; åˆ›å»º vector
[] item1 item2 item3

; DOM åˆ—è¡¨
div {} $ []
  button {} |Click
  span {} |Text
```

**å¸¸è§é”™è¯¯ï¼š**

```cirru
; âŒ é”™è¯¯ï¼šç”¨ vector ä¼ äº‹ä»¶
send-event! $ [] :clipboard/read text
; æŠ¥é”™ï¼štag-match expected tuple

; âœ… æ­£ç¡®ï¼šç”¨ tuple
send-event! $ :: :clipboard/read text
```

### ç±»å‹æ ‡æ³¨ä¸æ£€æŸ¥

Calcit æ”¯æŒå¯é€‰çš„ç±»å‹æ ‡æ³¨ï¼Œç”¨äºå¼€å‘æ—¶çš„ç±»å‹æ£€æŸ¥ã€‚

#### å‡½æ•°å‚æ•°ç±»å‹ (`assert-type`)

```cirru
defn calculate-total (items discount)
  assert-type items :list
  assert-type discount :number
  ; let ç»‘å®šä¸­çš„å˜é‡ä¼šè‡ªåŠ¨æ¨æ–­ç±»å‹
  let
      sum $ foldl items 0 &+
    * sum $ - 1 discount
```

#### å‡½æ•°è¿”å›ç±»å‹ (`hint-fn`)

```cirru
defn add-numbers (a b)
  assert-type a :number
  assert-type b :number
  hint-fn $ return-type :number
  &+ a b
```

**å¸¸è§ç±»å‹ï¼š** `:number` `:string` `:bool` `:list` `:map` `:set` `:tuple` `:keyword` `:nil`

**éªŒè¯ç±»å‹ï¼š** `cr --check-only` æˆ– `cr ir -1` æŸ¥çœ‹ IR ä¸­çš„ç±»å‹ä¿¡æ¯

### å…¶ä»–æ˜“é”™ç‚¹

æ¯”è¾ƒå®¹æ˜“çŠ¯çš„é”™è¯¯ï¼š

- Calcit ä¸­å­—ç¬¦ä¸²é€šè¿‡å‰ç¼€åŒºåˆ†ï¼Œ`|` å’Œ `"` å¼€å¤´è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚`|x` å¯¹åº” JavaScript å­—ç¬¦ä¸² `"x"`ã€‚äº§ç”Ÿ JSON æ—¶æ³¨æ„ä¸è¦é‡å¤åŒ…è£¹å¼•å·ã€‚
- Calcit é‡‡ç”¨ Cirru ç¼©è¿›è¯­æ³•ï¼Œå¯ä»¥ç†è§£æˆå»æ‰è·¨è¡Œæ‹¬å·æ”¹ç”¨ç¼©è¿›çš„ Lisp å˜ç§ã€‚ç”¨ `cr cirru parse` å’Œ `cr cirru format` äº’ç›¸è½¬åŒ–è¯•éªŒã€‚
- Calcit è·Ÿ Clojure åœ¨è¯­ä¹‰ä¸Šæ¯”è¾ƒåƒï¼Œä½†è¯­æ³•å±‚é¢åªç”¨åœ†æ‹¬å·ï¼Œä¸ç”¨æ–¹æ‹¬å·èŠ±æ‹¬å·ã€‚

---

## å¼€å‘è°ƒè¯•

ç®€å•è„šæœ¬ç”¨ `cr -1 <filepath>` ç›´æ¥æ‰§è¡Œã€‚ç¼–è¯‘ JavaScript ç”¨ `cr -1 <filepath> js` æ‰§è¡Œä¸€æ¬¡ç¼–è¯‘ã€‚

Calcit snapshot æ–‡ä»¶ä¸­ config æœ‰ `init-fn` å’Œ `reload-fn` é…ç½®ï¼š

- åˆæ¬¡å¯åŠ¨è°ƒç”¨ `init-fn`
- æ¯æ¬¡ä¿®æ”¹ä»£ç åè°ƒç”¨ `reload-fn`

**å…¸å‹å¼€å‘æµç¨‹ï¼š**

```bash
# 1. å¯åŠ¨ç›‘å¬æ¨¡å¼ï¼ˆç”¨æˆ·è‡ªè¡Œä½¿ç”¨ï¼‰
cr        # è§£é‡Šæ‰§è¡Œæ¨¡å¼
cr js     # JS ç¼–è¯‘æ¨¡å¼

# 2. ä¿®æ”¹ä»£ç åè§¦å‘å¢é‡æ›´æ–°ï¼ˆè¯¦è§"å¢é‡è§¦å‘æ›´æ–°"ç« èŠ‚ï¼‰
cr edit inc --changed ns/def

# 3. ä¸€æ¬¡æ€§æ‰§è¡Œ/ç¼–è¯‘ï¼ˆç”¨äºç®€å•è„šæœ¬ï¼‰
cr -1          # æ‰§è¡Œä¸€æ¬¡
cr -1 js       # ç¼–è¯‘ä¸€æ¬¡
```

### å¢é‡è§¦å‘æ›´æ–°ï¼ˆæ¨èï¼‰â­â­â­

å½“ä½¿ç”¨ç›‘å¬æ¨¡å¼ï¼ˆ`cr` æˆ– `cr js`ï¼‰å¼€å‘æ—¶ï¼Œæ¨èä½¿ç”¨ `cr edit inc` å‘½ä»¤è§¦å‘å¢é‡æ›´æ–°ï¼Œè€Œéå…¨é‡é‡æ–°ç¼–è¯‘/æ‰§è¡Œï¼š

**å·¥ä½œæµç¨‹ï¼š**

```bash
# ã€ç»ˆç«¯ 1ã€‘å¯åŠ¨ watcherï¼ˆç›‘å¬æ¨¡å¼ï¼‰
cr        # æˆ– cr js

# ã€ç»ˆç«¯ 2ã€‘ä¿®æ”¹ä»£ç åè§¦å‘å¢é‡æ›´æ–°
# ä¿®æ”¹å®šä¹‰
cr edit def app.core/my-fn -e 'defn my-fn (x) (+ x 1)'

# è§¦å‘å¢é‡æ›´æ–°
cr edit inc --changed app.core/my-fn

# ç­‰å¾… ~300ms åæŸ¥çœ‹ç¼–è¯‘ç»“æœ
cr query error
```

**å¢é‡æ›´æ–°å‘½ä»¤å‚æ•°ï¼š**

```bash
# æ–°å¢å®šä¹‰
cr edit inc --added namespace/definition

# ä¿®æ”¹å®šä¹‰
cr edit inc --changed namespace/definition

# åˆ é™¤å®šä¹‰
cr edit inc --removed namespace/definition

# æ–°å¢å‘½åç©ºé—´
cr edit inc --added-ns namespace

# åˆ é™¤å‘½åç©ºé—´
cr edit inc --removed-ns namespace

# æ›´æ–°å‘½åç©ºé—´å¯¼å…¥
cr edit inc --ns-updated namespace

# ç»„åˆä½¿ç”¨ï¼ˆæ‰¹é‡æ›´æ–°ï¼‰
cr edit inc \
  --changed app.core/add \
  --changed app.core/multiply \
  --removed app.core/old-fn
```

**æŸ¥çœ‹ç¼–è¯‘ç»“æœï¼š**

```bash
cr query error  # å‘½ä»¤ä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯æˆ–æˆåŠŸçŠ¶æ€
```

**ä½•æ—¶ä½¿ç”¨å…¨é‡æ“ä½œï¼š**

```bash
# æå°‘æ•°æƒ…å†µï¼šå¢é‡æ›´æ–°ä¸ç¬¦åˆé¢„æœŸæ—¶
cr -1 js           # é‡æ–°ç¼–è¯‘ JavaScript
cr -1              # é‡æ–°æ‰§è¡Œç¨‹åº

# æˆ–é‡å¯ç›‘å¬æ¨¡å¼ï¼ˆCtrl+C åœæ­¢åé‡å¯ï¼‰
cr        # æˆ– cr js

# CI/CD æˆ–è„šæœ¬éªŒè¯ï¼ˆä¸å¯åŠ¨ watcherï¼‰
cr --check-only    # ä»…è¯­æ³•æ£€æŸ¥
```

**å¢é‡æ›´æ–°ä¼˜åŠ¿ï¼š** å¿«é€Ÿåé¦ˆã€ç²¾ç¡®æ§åˆ¶å˜æ›´èŒƒå›´ã€watcher ä¿æŒè¿è¡ŒçŠ¶æ€

---

## æ–‡æ¡£æ”¯æŒ

é‡åˆ°ç–‘é—®æ—¶ä½¿ç”¨ï¼š

- `cr docs search <keyword>` - æœç´¢ Calcit æ•™ç¨‹å†…å®¹
- `cr docs read <filename>` - é˜…è¯»å®Œæ•´æ–‡æ¡£
- `cr docs list` - æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ–‡æ¡£
- `cr query ns <ns>` - æŸ¥çœ‹å‘½åç©ºé—´è¯´æ˜å’Œå‡½æ•°æ–‡æ¡£
- `cr query peek <ns/def>` - å¿«é€ŸæŸ¥çœ‹å®šä¹‰ç­¾å
- `cr query def <ns/def>` - è¯»å–å®Œæ•´è¯­æ³•æ ‘
- `cr query examples <ns/def>` - æŸ¥çœ‹ç¤ºä¾‹ä»£ç 
- `cr query find <name>` - è·¨å‘½åç©ºé—´æœç´¢ç¬¦å·
- `cr query usages <ns/def>` - æŸ¥æ‰¾å®šä¹‰çš„ä½¿ç”¨ä½ç½®
- `cr query search <pattern> [-f <ns/def>]` - æœç´¢å¶å­èŠ‚ç‚¹
- `cr query search-expr <pattern> [-f <ns/def>]` - æœç´¢ç»“æ„è¡¨è¾¾å¼
- `cr query error` - æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯å †æ ˆ

---

## ä»£ç ä¿®æ”¹ç¤ºä¾‹

**æ·»åŠ æ–°å‡½æ•°ï¼š**

````bash
# Cirru one liner
cr edit def app.core/multiply -e 'defn multiply (x y) (* x y)'
# åŸºæœ¬æ“ä½œï¼š**

```bash
# æ·»åŠ æ–°å‡½æ•°ï¼ˆå‘½ä»¤ä¼šæç¤º Next stepsï¼‰
cr edit def 'app.core/multiply' -e 'defn multiply (x y) (* x y)'

# æ›¿æ¢æ•´ä¸ªå®šä¹‰ï¼ˆ-p '' è¡¨ç¤ºæ ¹è·¯å¾„ï¼‰
cr tree replace 'app.core/multiply' -p '' -e 'defn multiply (x y z) (* x y z)'

# æ›´æ–°æ–‡æ¡£å’Œç¤ºä¾‹
cr edit doc 'app.core/multiply' 'ä¹˜æ³•å‡½æ•°ï¼Œè¿”å›ä¸¤ä¸ªæ•°çš„ç§¯'
cr edit add-example 'app.core/multiply' -e 'multiply 5 6'
````

**ä¿®æ”¹å®šä¹‰å·¥ä½œæµï¼ˆå‘½ä»¤ä¼šæ˜¾ç¤ºå­èŠ‚ç‚¹ç´¢å¼•å’Œ Next stepsï¼‰ï¼š**

```bash
# 1. æœç´¢å®šä½
cr query search '<pattern>' -f 'ns/def' -l

# 2. æŸ¥çœ‹èŠ‚ç‚¹ï¼ˆè¾“å‡ºä¼šæ˜¾ç¤ºç´¢å¼•å’Œæ“ä½œæç¤ºï¼‰
cr tree show 'ns/def' -p '<path>'

# 3. æ‰§è¡Œæ›¿æ¢ï¼ˆä¼šæ˜¾ç¤º diff å’ŒéªŒè¯å‘½ä»¤ï¼‰
cr tree replace 'ns/def' -p '<path>' --leaf -e '<value>'

# 4. æ£€æŸ¥ç»“æœ
cr query error
# æ·»åŠ å‘½åç©ºé—´
cr edit add-ns app.util

# æ·»åŠ å¯¼å…¥è§„åˆ™
cr edit add-import app.main -e 'app.util :refer $ helper'

# ç§»é™¤å¯¼å…¥è§„åˆ™
cr edit rm-import app.main app.util

# æ›´æ–°é¡¹ç›®é…ç½®
cr edit config init-fn app.main/main!
```

**æ›´æ–°å‘½åç©ºé—´å¯¼å…¥ï¼ˆå…¨é‡æ›¿æ¢ï¼‰ï¼š**

```bash
cr edit imports app.main -j '[["app.lib", ":as", "lib"], ["app.util", ":refer", ["helper"]]]'
```

---

## âš ï¸ å¸¸è§é™·é˜±å’Œæœ€ä½³å®è·µ

### 1. è·¯å¾„ç´¢å¼•åŠ¨æ€å˜åŒ–é—®é¢˜ â­â­â­

**æ ¸å¿ƒåŸåˆ™ï¼š** åˆ é™¤/æ’å…¥ä¼šæ”¹å˜åŒçº§åç»­èŠ‚ç‚¹ç´¢å¼•ã€‚

**æ‰¹é‡ä¿®æ”¹ç­–ç•¥ï¼š**

- **ä»åå¾€å‰æ“ä½œ**ï¼ˆæ¨èï¼‰ï¼šå…ˆåˆ å¤§ç´¢å¼•ï¼Œå†åˆ å°ç´¢å¼•
- **å•æ¬¡æ“ä½œåé‡æ–°æœç´¢**ï¼šæ¯æ¬¡ä¿®æ”¹ç«‹å³ç”¨ `cr query search` æ›´æ–°è·¯å¾„
- **æ•´ä½“é‡å†™**ï¼šç”¨ `cr tree replace -p ""` æ›¿æ¢æ•´ä¸ªå®šä¹‰

å‘½ä»¤ä¼šåœ¨è·¯å¾„é”™è¯¯æ—¶æç¤ºæœ€é•¿æœ‰æ•ˆè·¯å¾„å’Œå¯ç”¨å­èŠ‚ç‚¹ã€‚

### 2. è¾“å…¥æ ¼å¼å‚æ•°ä½¿ç”¨é€ŸæŸ¥ â­â­â­

**å‚æ•°æ··æ·†çŸ©é˜µï¼ˆå·²å…¨é¢æ”¯æŒ `-e` è‡ªåŠ¨è¯†åˆ«ï¼‰ï¼š**

| åœºæ™¯                | ç¤ºä¾‹ç”¨æ³•                               | è§£æç»“æœ                      | è¯´æ˜                              |
| ------------------- | -------------------------------------- | ----------------------------- | --------------------------------- |
| **è¡¨è¾¾å¼ (Cirru)**  | `-e 'defn add (a b) (+ a b)'`          | `["defn", "add", ...]` (List) | é»˜è®¤æŒ‰ Cirru one-liner è§£æ       |
| **åŸå­ç¬¦å· (Leaf)** | `--leaf -e 'my-symbol'`                | `"my-symbol"` (Leaf)          | **æ¨è**ï¼Œé¿å…è¢«åŒ…è£…æˆ list       |
| **å­—ç¬¦ä¸² (Leaf)**   | `--leaf -e '\|hello world'`            | `"hello world"` (Leaf)        | ç¬¦å·å‰ç¼€ `\|` è¡¨ç¤ºå­—ç¬¦ä¸²          |
| **JSON æ•°ç»„**       | `-e '["+", "x", "1"]'`                 | `["+", "x", "1"]` (List)      | **è‡ªåŠ¨è¯†åˆ«** (å« `[` ä¸”æœ‰ `"`)    |
| **JSON å­—ç¬¦ä¸²**     | `-e '"my leaf"'`                       | `"my leaf"` (Leaf)            | **è‡ªåŠ¨è¯†åˆ«** (å«å¼•ç”¨çš„å­—ç¬¦ä¸²)     |
| **å†…è” JSON**       | `-j '["defn", ...]'`                   | `["defn", ...]` (List)        | æ˜¾å¼æŒ‰ JSON è§£æï¼Œå¿½ç•¥ Cirru è§„åˆ™ |
| **å¤–éƒ¨æ–‡ä»¶**        | `-f code.cirru` (æˆ– `-f code.json -J`) | æ ¹æ®æ–‡ä»¶å†…å®¹è§£æ              | `-J` ç”¨äºæ ‡è®°æ–‡ä»¶å†…æ˜¯ JSON        |

**æ ¸å¿ƒè§„åˆ™ï¼š**

1. **æ™ºèƒ½è¯†åˆ«æ¨¡å¼**ï¼š`-e / --code` ç°åœ¨ä¼šè‡ªåŠ¨è¯†åˆ« JSONã€‚å¦‚æœä½ ä¼ å…¥ `["a"]` æˆ– `"a"`ï¼Œå®ƒä¼šç›´æ¥æŒ‰ JSON å¤„ç†ï¼Œæ— éœ€å†é¢å¤–åŠ  `-J` æˆ– `-j`ã€‚
2. **å¼ºåˆ¶ Leaf æ¨¡å¼**ï¼šå¦‚æœä½ éœ€è¦ç¡®ä¿è¾“å…¥æ˜¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆç¬¦å·æˆ–å­—ç¬¦ä¸²ï¼‰ï¼Œè¯·åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ `--leaf` å¼€å…³ã€‚å®ƒä¼šå°†åŸå§‹è¾“å…¥ç›´æ¥ä½œä¸ºå†…å®¹ï¼Œä¸ç»è¿‡ä»»ä½•è§£æã€‚
3. **æ˜¾å¼ JSON æ¨¡å¼**ï¼šå¦‚æœä½ æƒ³æ˜ç¡®å‘Šè¯‰å·¥å…·â€œè¿™æ®µå°±æ˜¯ JSONâ€ï¼Œä¼˜å…ˆç”¨ `-j '<json>'`ã€‚
4. **ç»Ÿä¸€æ€§**ï¼š`cr tree` å’Œ `cr edit` çš„æ‰€æœ‰å­å‘½ä»¤ï¼ˆreplace, def, insert ç­‰ï¼‰ç°åœ¨å…±äº«å®Œå…¨ç›¸åŒçš„è¾“å…¥è§£æé€»è¾‘ã€‚

**å®æˆ˜ç¤ºä¾‹ï¼š**

```bash
# âœ… æ›¿æ¢è¡¨è¾¾å¼
cr tree replace app.main/fn -p "2" -e 'println |hello'

# âœ… æ›¿æ¢ leafï¼ˆæ¨è --leafï¼‰
cr tree replace app.main/fn -p "2,0" --leaf -e 'new-symbol'

# âœ… æ›¿æ¢å­—ç¬¦ä¸² leaf
cr tree replace app.main/fn -p "2,1" --leaf -e '|new text'

# âŒ é¿å…ï¼šç”¨ -e ä¼ å•ä¸ª tokenï¼ˆä¼šå˜æˆ listï¼‰
cr tree replace app.main/fn -p "2,0" -e 'symbol'  # ç»“æœï¼š["symbol"]
```

### 3. Cirru å­—ç¬¦ä¸²å’Œæ•°æ®ç±»å‹ â­â­

**Cirru å­—ç¬¦ä¸²å‰ç¼€ï¼š**

| Cirru å†™æ³•     | JSON ç­‰ä»·      | ä½¿ç”¨åœºæ™¯     |
| -------------- | -------------- | ------------ |
| `\|hello`      | `"hello"`      | æ¨èï¼Œç®€æ´   |
| `"hello"`      | `"hello"`      | ä¹Ÿå¯ä»¥       |
| `\|a b c`      | `"a b c"`      | åŒ…å«ç©ºæ ¼     |
| `\|[tag] text` | `"[tag] text"` | åŒ…å«ç‰¹æ®Šå­—ç¬¦ |

**Tuple vs Vectorï¼š**

```cirru
; âœ… Tuple - ç”¨äºäº‹ä»¶ã€æ¨¡å¼åŒ¹é…
:: :clipboard/read text

; âœ… Vector - ç”¨äº DOM åˆ—è¡¨
[] (button) (div)

; âŒ é”™è¯¯ï¼šç”¨ vector ä¼ äº‹ä»¶
send-to-component! $ [] :clipboard/read text
; æŠ¥é”™ï¼štag-match expected tuple

; âœ… æ­£ç¡®ï¼šç”¨ tuple
send-to-component! $ :: :clipboard/read text
```

**è®°å¿†è§„åˆ™ï¼š**

- **`::` (tuple)**: äº‹ä»¶ã€æ¨¡å¼åŒ¹é…ã€ä¸å¯å˜æ•°æ®ç»“æ„
- **`[]` (vector)**: DOM å…ƒç´ åˆ—è¡¨ã€åŠ¨æ€é›†åˆ

### 4. æ¨èå·¥ä½œæµç¨‹

**åŸºæœ¬æµç¨‹ï¼ˆsearch å¿«é€Ÿå®šä½ â­â­â­ï¼‰ï¼š**

```bash
# 1. å¿«é€Ÿå®šä½ï¼ˆæ¯”é€å±‚å¯¼èˆªå¿«10å€ï¼‰
cr query search 'target' -f 'ns/def'           # æˆ– search-expr 'fn (x)' -l æœç´¢ç»“æ„

# 2. æ‰§è¡Œä¿®æ”¹ï¼ˆä¼šæ˜¾ç¤º diff å’ŒéªŒè¯å‘½ä»¤ï¼‰
cr tree replace 'ns/def' -p "<path>" --leaf -e '<value>'

# 3. å¢é‡æ›´æ–°ï¼ˆæ¨èï¼‰
cr edit inc --changed ns/def
# ç­‰å¾… ~300ms åæ£€æŸ¥
cr query error
```

**æ–°æ‰‹æç¤ºï¼š**

- ä¸çŸ¥é“ç›®æ ‡åœ¨å“ªï¼Ÿç”¨ `search` æˆ– `search-expr` å¿«é€Ÿæ‰¾åˆ°æ‰€æœ‰åŒ¹é…
- æƒ³äº†è§£ä»£ç ç»“æ„ï¼Ÿç”¨ `tree show` é€å±‚æ¢ç´¢
- éœ€è¦æ‰¹é‡é‡å‘½åï¼Ÿæœç´¢åæŒ‰æç¤ºä»å¤§åˆ°å°è·¯å¾„ä¾æ¬¡ä¿®æ”¹
- ä¸ç¡®å®šä¿®æ”¹æ˜¯å¦æ­£ç¡®ï¼Ÿæ¯æ­¥åç”¨ `tree show` éªŒè¯

### 5. Shell ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ â­â­

Calcit å‡½æ•°åä¸­çš„ `?`, `->`, `!` ç­‰å­—ç¬¦åœ¨ bash/zsh ä¸­æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œéœ€è¦ç”¨å•å¼•å·åŒ…è£¹ï¼š

```bash
# âŒ é”™è¯¯
cr query def app.main/valid?
cr eval '-> x (+ 1) (* 2)'

# âœ… æ­£ç¡®
cr query def 'app.main/valid?'
cr eval 'thread-first x (+ 1) (* 2)'  # ç”¨ thread-first ä»£æ›¿ ->
```

**å»ºè®®ï¼š** å‘½ä»¤è¡Œä¸­ä¼˜å…ˆä½¿ç”¨è‹±æ–‡åç§°ï¼ˆ`thread-first` è€Œé `->`ï¼‰ï¼Œæ›´æ¸…æ™°ä¸”æ— éœ€è½¬ä¹‰ã€‚

---

## ğŸ’¡ Calcit vs Clojure å…³é”®å·®å¼‚

**è¯­æ³•å±‚é¢ï¼š**

- **åªç”¨åœ†æ‹¬å·**ï¼šCalcit çš„ Cirru è¯­æ³•ä¸ä½¿ç”¨æ–¹æ‹¬å· `[]` å’ŒèŠ±æ‹¬å· `{}`ï¼Œç»Ÿä¸€ç”¨ç¼©è¿›è¡¨è¾¾ç»“æ„
- **å‡½æ•°å‰ç¼€**ï¼šCalcit ç”¨ `&` åŒºåˆ†å†…ç½®å‡½æ•°ï¼ˆ`&+`ã€`&str`ï¼‰å’Œç”¨æˆ·å®šä¹‰å‡½æ•°

**é›†åˆå‡½æ•°å‚æ•°é¡ºåºï¼ˆæ˜“é”™ â­â­â­ï¼‰ï¼š**

- **Calcit**: é›†åˆåœ¨**ç¬¬ä¸€ä½** â†’ `map data fn` æˆ– `-> data (map fn)`
- **Clojure**: å‡½æ•°åœ¨ç¬¬ä¸€ä½ â†’ `(map fn data)` æˆ– `(->> data (map fn))`
- **ç—‡çŠ¶**ï¼š`unknown data for foldl-shortcut` æŠ¥é”™
- **åŸå› **ï¼šè¯¯ç”¨ `->>` æˆ–å‚æ•°é¡ºåºé”™è¯¯

**å…¶ä»–å·®å¼‚ï¼š**

- **å®ç³»ç»Ÿ**ï¼šCalcit æ›´ç®€æ´ï¼Œç¼ºå°‘ Clojure çš„ reader macroï¼ˆå¦‚ `#()`ï¼‰
- **æ•°æ®ç±»å‹**ï¼šCalcit çš„ Tuple (`::`) å’Œ Vector (`[]`) æœ‰ç‰¹å®šç”¨é€”ï¼ˆè§"Cirru å­—ç¬¦ä¸²å’Œæ•°æ®ç±»å‹"ï¼‰

---

## å¸¸è§é”™è¯¯æ’æŸ¥

| é”™è¯¯ä¿¡æ¯                     | åŸå›                     | è§£å†³æ–¹æ³•                          |
| ---------------------------- | ----------------------- | --------------------------------- |
| `Path index X out of bounds` | è·¯å¾„å·²è¿‡æœŸ              | é‡æ–°è¿è¡Œ `cr query search`        |
| `tag-match expected tuple`   | ä¼ å…¥ vector è€Œé tuple  | æ”¹ç”¨ `::`                         |
| å­—ç¬¦ä¸²è¢«æ‹†åˆ†                 | æ²¡æœ‰ç”¨ `\|` æˆ– `"` åŒ…è£¹ | ä½¿ç”¨ `\|complete string`          |
| `unexpected format`          | è¯­æ³•é”™è¯¯                | ç”¨ `cr cirru parse '<code>'` éªŒè¯ |

**è°ƒè¯•å‘½ä»¤ï¼š** `cr query error`ï¼ˆä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯å †æ ˆå’Œæç¤ºï¼‰
